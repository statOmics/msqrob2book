<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Chapter 7 The mouse diet use case: a Skyline TMT DDA dataset | Statistical analysis of mass spectrometry-based proteomics data" />
<meta property="og:type" content="book" />




<meta name="author" content="Christophe Vanderaa, Stijn Vandenbulcke, Lieven Clement" />

<meta name="date" content="2025-11-12" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="Chapter 7 The mouse diet use case: a Skyline TMT DDA dataset | Statistical analysis of mass spectrometry-based proteomics data">

<title>Chapter 7 The mouse diet use case: a Skyline TMT DDA dataset | Statistical analysis of mass spectrometry-based proteomics data</title>

<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/envisioned.css" rel="stylesheet" />
<link href="libs/msmb-css-0/msmb.css" rel="stylesheet" />
<script>
function toggle_visibility(id1, id2) {
var e = document.getElementById(id1);
var f = document.getElementById(id2);

e.style.display = ((e.style.display!='none') ? 'none' : 'block');

if(f.classList.contains('fa-plus-square')) {
    f.classList.add('fa-minus-square')
    f.classList.remove('fa-plus-square')
} else {
    f.classList.add('fa-plus-square')
    f.classList.remove('fa-minus-square')
}

}
</script>
<script>
function copy_link(id) {
  var dummy = document.createElement('input'),
  text = window.location.href.split(/[?#]/)[0] + '#' + id;
  document.body.appendChild(dummy);
  dummy.value = text;
  dummy.select();
  document.execCommand('copy');
  document.body.removeChild(dummy);
  
  var tooltip = document.getElementById(id + '-tooltip');
  tooltip.innerHTML = 'Copied!';
}

function reset_tooltip(id) {
  var tooltip = document.getElementById(id);
  tooltip.innerHTML = 'Copy link';
}
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }

code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul class="navbar">
<li class="msmb"><p class="title">Statistical analysis of mass spectrometry-based proteomics data<p><p class="author">Christophe Vanderaa, Stijn Vandenbulcke, Lieven Clement</p>
<li class="dropdown" style="float:right">
<a href="javascript:void(0)" class="dropbtn">&#x25BE; Chapters</a>
<div class="dropdown-content">
<a href="index.html" id="toc-preamble"><span class="toc-section-number">1</span> Preamble</a>
<a href="sec-basics.html" id="toc-sec-basics"><span class="toc-section-number">2</span> Statistical analysis with msqrob2</a>
<a href="sec-advanced.html" id="toc-sec-advanced"><span class="toc-section-number">3</span> Advanced statistical analysis with msqrob2</a>
<a href="sec-benchmarking.html" id="toc-sec-benchmarking"><span class="toc-section-number">4</span> Benchmarking workflows</a>
<a href="sec-francisella.html" id="toc-sec-francisella"><span class="toc-section-number">5</span> The francisella use case: a MaxQuant LFQ DDA dataset with technical replication</a>
<a href="sec-heart.html" id="toc-sec-heart"><span class="toc-section-number">6</span> Heart use case: a MaxQuant LFQ DDA dataset with a more complex design</a>
<a id="active-page" href="sec-mouse_diet.html#sec-mouse_diet" id="toc-sec-mouse_diet"><span class="toc-section-number">7</span> The mouse diet use case: a Skyline TMT DDA dataset</a><ul class="toc-sections">
<li class="toc"><a href="#introduction-2"> Introduction</a></li>
<li class="toc"><a href="#load-packages-5"> Load packages</a></li>
<li class="toc"><a href="#load-data-2"> Load data</a></li>
<li class="toc"><a href="#data-preprocessing-4"> Data preprocessing</a></li>
<li class="toc"><a href="#data-exploration-3"> Data exploration</a></li>
<li class="toc"><a href="#data-modelling-3"> Data modelling</a></li>
<li class="toc"><a href="#conclusion-4"> Conclusion</a></li>
</ul>
<a href="sec-end.html" id="toc-sec-end"><span class="toc-section-number">8</span> Usefull links and session information</a>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="sec-mouse_diet" class="section level1" number="7">
<h1>
<span class="header-section-number">Chapter 7</span> The mouse diet use case: a Skyline TMT DDA dataset</h1>
<div id="introduction-2" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Introduction<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('introduction-2')" onmouseout="reset_tooltip('introduction-2-tooltip')"><span class="tooltiptext" id="introduction-2-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>If you never used <code>msqrob2</code>, we suggest to familiarise yourself with
the <a href="sec-basics.html#sec-basics">basic concepts chapter</a> first. Note that TMT
experiments imposes complex designs, hence we also suggest reading the
<a href="sec-advanced.html#sec-advanced">advanced concepts chapter</a>.</p>
<p>We will demonstrate the msqrob2TMT workflow, a data processing and
modelling workflow dedicated to the analysis of TMT-based proteomics
datasets. We will demonstrated the workflow using the study published
by <span class="citation">Plubell et al. (<label for="tufte-mn-18" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-18" class="margin-toggle">2017<span class="marginnote">Plubell, Deanna L, Phillip A Wilmarth, Yuqi Zhao, Alexandra M Fenton, Jessica Minnier, Ashok P Reddy, John Klimek, Xia Yang, Larry L David, and Nathalie Pamir. 2017. <span>“Extended Multiplexing of Tandem Mass Tags (<span>TMT</span>) Labeling Reveals Age and High Fat Diet Specific Proteome Changes in Mouse Epididymal Adipose Tissue.”</span> <em>Mol. Cell. Proteomics</em> 16 (5): 873–90.</span>)</span>, illustrating the statistical concepts using a
real-life use case.</p>
<p>Since this chapter uses a real-life study, we cannot objectively
assess the results. The <a href="#sec-advances">advanced concepts chapter</a>
demonstrates an msqrob2TMT analysis with ground truth information.</p>
<p>Before delving further into the use case, let us prepare our
computational environment.</p>
</div>
<div id="load-packages-5" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Load packages<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('load-packages-5')" onmouseout="reset_tooltip('load-packages-5-tooltip')"><span class="tooltiptext" id="load-packages-5-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>First, we load the <code>msqrob2</code> package and additional packages for data
manipulation and visualisation.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="sec-mouse_diet.html#cb300-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"msqrob2"</span>)</span>
<span id="cb300-2"><a href="sec-mouse_diet.html#cb300-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb300-3"><a href="sec-mouse_diet.html#cb300-3" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"patchwork"</span>)</span>
<span id="cb300-4"><a href="sec-mouse_diet.html#cb300-4" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggrepel"</span>)</span>
<span id="cb300-5"><a href="sec-mouse_diet.html#cb300-5" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span></code></pre></div>
<p>We also configure the <a href="sec-basics.html#sec-parallel">parallelisation</a> framework.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="sec-mouse_diet.html#cb301-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"BiocParallel"</span>)</span>
<span id="cb301-2"><a href="sec-mouse_diet.html#cb301-2" tabindex="-1"></a><span class="fu">register</span>(<span class="fu">SerialParam</span>())</span></code></pre></div>
</div>
<div id="load-data-2" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Load data<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('load-data-2')" onmouseout="reset_tooltip('load-data-2-tooltip')"><span class="tooltiptext" id="load-data-2-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<div id="sec-exp_design_mouse" class="section level3" number="7.3.1">
<h3>
<span class="header-section-number">7.3.1</span> Experimental context<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('sec-exp_design_mouse')" onmouseout="reset_tooltip('sec-exp_design_mouse-tooltip')"><span class="tooltiptext" id="sec-exp_design_mouse-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>The data used in this vignette has been published by <span class="citation">Plubell et al. (<label for="tufte-mn-19" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-19" class="margin-toggle">2017<span class="marginnote">Plubell, Deanna L, Phillip A Wilmarth, Yuqi Zhao, Alexandra M Fenton, Jessica Minnier, Ashok P Reddy, John Klimek, Xia Yang, Larry L David, and Nathalie Pamir. 2017. <span>“Extended Multiplexing of Tandem Mass Tags (<span>TMT</span>) Labeling Reveals Age and High Fat Diet Specific Proteome Changes in Mouse Epididymal Adipose Tissue.”</span> <em>Mol. Cell. Proteomics</em> 16 (5): 873–90.</span>)</span>
(PXD005953). The objective of the experiment was to explore the impact
of low-fat and high-fat diets on the proteomic content of adipose
tissue in mice. It also assesses whether the duration of the diet may
impact the results. The authors assigned twenty mice into four groups
(5 mice per group) based on their diet, either low-fat (LF) or
high-fat (HF), and the duration of the diet, which was classified as
short (8 weeks) or long (18 weeks). Samples from the epididymal
adipose tissue were extracted from each mice. The samples were then
randomly distributed across three TMT 10-plex mixtures for analysis.
In each mixture, two reference labels were used, each containing
pooled samples that included a range of peptides from all the samples.
Not all labels were used, leading to an unbalanced design. Each TMT
10-plex mixture was fractionated into nine parts, resulting in a total
of 27 MS runs.</p>
<div class="figure">
<img src="figs/mouse_experiment.png" alt="Overview of the experimental design. Taken from Plubell et al. 2017." width="941"><p class="caption marginnote shownote">
Overview of the experimental design. Taken from Plubell et al. 2017.
</p>
</div>
</div>
<div id="getting-the-data-2" class="section level3" number="7.3.2">
<h3>
<span class="header-section-number">7.3.2</span> Getting the data<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('getting-the-data-2')" onmouseout="reset_tooltip('getting-the-data-2-tooltip')"><span class="tooltiptext" id="getting-the-data-2-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>The data were reanalyzed by <span class="citation">Huang et al. (<label for="tufte-mn-20" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-20" class="margin-toggle">2020<span class="marginnote">Huang, Ting, Meena Choi, Manuel Tzouros, Sabrina Golling, Nikhil Janak Pandya, Balazs Banfai, Tom Dunkley, and Olga Vitek. 2020. <span>“<span>MSstatsTMT</span>: Statistical Detection of Differentially Abundant Proteins in Experiments with Isobaric Labeling and Multiple Mixtures.”</span> <em>Mol. Cell. Proteomics</em> 19 (10): 1706–23.</span>)</span> and have been deposited in
the <code>MSV000084264</code> MASSiVE repository, but we will retrieve the
timestamped data from our <a href="https://zenodo.org/records/14767905">Zenodo
repository</a>. We need 2 files: the
Skyline identification and quantification table generated by the
authors and the sample annotation files<label for="tufte-sn-32" class="margin-toggle sidenote-number">32</label><input type="checkbox" id="tufte-sn-32" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">32</span> note that these files are
<a href="sec-advanced.html#sec-caching">locally cached</a></span>.</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="sec-mouse_diet.html#cb302-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"BiocFileCache"</span>)</span>
<span id="cb302-2"><a href="sec-mouse_diet.html#cb302-2" tabindex="-1"></a>bfc <span class="ot">&lt;-</span> <span class="fu">BiocFileCache</span>()</span>
<span id="cb302-3"><a href="sec-mouse_diet.html#cb302-3" tabindex="-1"></a>psmFile <span class="ot">&lt;-</span> <span class="fu">bfcrpath</span>(bfc, <span class="st">"https://zenodo.org/records/14767905/files/mouse_psms.txt?download=1"</span>)</span>
<span id="cb302-4"><a href="sec-mouse_diet.html#cb302-4" tabindex="-1"></a>annotFile <span class="ot">&lt;-</span> <span class="fu">bfcrpath</span>(bfc, <span class="st">"https://zenodo.org/records/14767905/files/mouse_annotations.csv?download=1"</span>)</span></code></pre></div>
<p>This analysis starts with the <a href="sec-advanced.html#sec-psm_table">PSM table</a>. Note that
columns that start with <code>"Abundance."</code> contain the quantitative values
for each TMT label.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="sec-mouse_diet.html#cb303-1" tabindex="-1"></a>psms <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(psmFile)</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="0%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="2%">
<col width="3%">
<col width="1%">
<col width="1%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="22%">
<col width="1%">
<col width="0%">
<col width="1%">
<col width="0%">
<col width="0%">
<col width="1%">
<col width="0%">
<col width="0%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="0%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="0%">
<col width="1%">
<col width="6%">
<col width="0%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="0%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="1%">
</colgroup>
<thead><tr class="header">
<th align="left">Checked</th>
<th align="left">Confidence</th>
<th align="left">Identifying.Node</th>
<th align="left">PSM.Ambiguity</th>
<th align="left">Annotated.Sequence</th>
<th align="left">Modifications</th>
<th align="right">X..Protein.Groups</th>
<th align="right">X..Proteins</th>
<th align="left">Master.Protein.Accessions</th>
<th align="left">Master.Protein.Descriptions</th>
<th align="left">Protein.Accessions</th>
<th align="left">Protein.Descriptions</th>
<th align="right">X..Missed.Cleavages</th>
<th align="right">Charge</th>
<th align="right">DeltaScore</th>
<th align="right">DeltaCn</th>
<th align="right">Rank</th>
<th align="right">Search.Engine.Rank</th>
<th align="right">m.z..Da.</th>
<th align="right">MH…Da.</th>
<th align="right">Theo..MH…Da.</th>
<th align="right">DeltaM..ppm.</th>
<th align="right">Deltam.z..Da.</th>
<th align="left">Activation.Type</th>
<th align="left">MS.Order</th>
<th align="right">Isolation.Interference….</th>
<th align="right">Average.Reporter.S.N</th>
<th align="right">Ion.Inject.Time..ms.</th>
<th align="right">RT..min.</th>
<th align="right">First.Scan</th>
<th align="left">Spectrum.File</th>
<th align="left">File.ID</th>
<th align="right">Abundance..126</th>
<th align="right">Abundance..127N</th>
<th align="right">Abundance..127C</th>
<th align="right">Abundance..128N</th>
<th align="right">Abundance..128C</th>
<th align="right">Abundance..129N</th>
<th align="right">Abundance..129C</th>
<th align="right">Abundance..130N</th>
<th align="right">Abundance..130C</th>
<th align="right">Abundance..131</th>
<th align="left">Quan.Info</th>
<th align="right">Ions.Score</th>
<th align="right">Identity.Strict</th>
<th align="right">Identity.Relaxed</th>
<th align="right">Expectation.Value</th>
<th align="right">Percolator.q.Value</th>
<th align="right">Percolator.PEP</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">False</td>
<td align="left">High</td>
<td align="left">Mascot (A2)</td>
<td align="left">Unambiguous</td>
<td align="left">[K].aIDILDR.[SM]</td>
<td align="left">N-Term(TMT6plex)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">Q61084</td>
<td align="left">Mitogen-activated protein kinase kinase kinase 3 OS=Mus musculus GN=Map3k3 PE=1 SV=1</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">522.8161</td>
<td align="right">1044.625</td>
<td align="right">1044.625</td>
<td align="right">-0.14</td>
<td align="right">-0.00008</td>
<td align="left">CID</td>
<td align="left">MS2</td>
<td align="right">2.279464</td>
<td align="right">10.5</td>
<td align="right">42.390</td>
<td align="right">63.4111</td>
<td align="right">16103</td>
<td align="left">PAMI-194_Mouse_U-Dd_TMT_40ug_28pctACN_25cm_120min_20160426_OT.raw</td>
<td align="left">F3.6</td>
<td align="right">2382.454</td>
<td align="right">2429.068</td>
<td align="right">2707.243</td>
<td align="right">3317.650</td>
<td align="right">5035.093</td>
<td align="right">3031.7993</td>
<td align="right">4808.5522</td>
<td align="right">2583.115</td>
<td align="right">3103.613</td>
<td align="right">2795.283</td>
<td align="left">NA</td>
<td align="right">40</td>
<td align="right">25</td>
<td align="right">18</td>
<td align="right">0.0003802</td>
<td align="right">0.0008956</td>
<td align="right">0.0111900</td>
</tr>
<tr class="even">
<td align="left">False</td>
<td align="left">High</td>
<td align="left">Mascot (C2)</td>
<td align="left">Unambiguous</td>
<td align="left">[K].aLEENNNFSk.[M]</td>
<td align="left">N-Term(TMT6plex); K10(TMT6plex)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">P55821</td>
<td align="left">Stathmin-2 OS=Mus musculus GN=Stmn2 PE=1 SV=1</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">812.4410</td>
<td align="right">1623.875</td>
<td align="right">1623.874</td>
<td align="right">0.26</td>
<td align="right">0.00021</td>
<td align="left">CID</td>
<td align="left">MS2</td>
<td align="right">20.489330</td>
<td align="right">0.8</td>
<td align="right">116.000</td>
<td align="right">38.9028</td>
<td align="right">7622</td>
<td align="left">PAMI-176_Mouse_A-J_TMT_40ug_22pctACN_25cm_120min_20160223_OT.raw</td>
<td align="left">F1.3</td>
<td align="right">1112.530</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">389.5883</td>
<td align="right">963.0698</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">49</td>
<td align="right">29</td>
<td align="right">22</td>
<td align="right">0.0000932</td>
<td align="right">0.0000000</td>
<td align="right">0.0000510</td>
</tr>
<tr class="odd">
<td align="left">False</td>
<td align="left">High</td>
<td align="left">Mascot (C2)</td>
<td align="left">Rejected</td>
<td align="left">[K].eMISDIk.[F]</td>
<td align="left">N-Term(TMT6plex); K7(TMT6plex)</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">Q5SQM0</td>
<td align="left">Echinoderm microtubule-associated protein-like 6 OS=Mus musculus GN=Eml6 PE=2 SV=1</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">647.3786</td>
<td align="right">1293.750</td>
<td align="right">1293.749</td>
<td align="right">0.84</td>
<td align="right">0.00054</td>
<td align="left">CID</td>
<td align="left">MS2</td>
<td align="right">62.114720</td>
<td align="right">25.4</td>
<td align="right">50.658</td>
<td align="right">45.5494</td>
<td align="right">10094</td>
<td align="left">PAMI-176_Mouse_A-J_TMT_40ug_24pctACN_25cm_120min_20160223_OT.raw</td>
<td align="left">F1.4</td>
<td align="right">8606.559</td>
<td align="right">10042.301</td>
<td align="right">7976.240</td>
<td align="right">5196.599</td>
<td align="right">9381.061</td>
<td align="right">12227.7070</td>
<td align="right">6418.2720</td>
<td align="right">5791.740</td>
<td align="right">9665.493</td>
<td align="right">5747.680</td>
<td align="left">NA</td>
<td align="right">11</td>
<td align="right">28</td>
<td align="right">21</td>
<td align="right">0.5635688</td>
<td align="right">0.0016120</td>
<td align="right">0.0284500</td>
</tr>
<tr class="even">
<td align="left">False</td>
<td align="left">High</td>
<td align="left">Mascot (C2)</td>
<td align="left">Unambiguous</td>
<td align="left">[KR].iIDFGLAR.[HQRT]</td>
<td align="left">N-Term(TMT6plex)</td>
<td align="right">4</td>
<td align="right">3</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">Q3UIZ8; Q5SUV5; Q8VCR8</td>
<td align="left">Myosin light chain kinase 3 OS=Mus musculus GN=Mylk3 PE=1 SV=1; Myosin light chain kinase family member 4 OS=Mus musculus GN=Mylk4 PE=1 SV=2; Myosin light chain kinase 2, skeletal/cardiac muscle OS=Mus musculus GN=Mylk2 PE=1 SV=2</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">567.3476</td>
<td align="right">1133.688</td>
<td align="right">1133.688</td>
<td align="right">-0.09</td>
<td align="right">-0.00005</td>
<td align="left">CID</td>
<td align="left">MS2</td>
<td align="right">30.288610</td>
<td align="right">13.5</td>
<td align="right">41.830</td>
<td align="right">70.4334</td>
<td align="right">19108</td>
<td align="left">PAMI-176_Mouse_A-J_TMT_40ug_30pctACN_25cm_120min_20160223_OT.raw</td>
<td align="left">F1.7</td>
<td align="right">4964.429</td>
<td align="right">5950.643</td>
<td align="right">3133.549</td>
<td align="right">3321.042</td>
<td align="right">2914.397</td>
<td align="right">3274.3197</td>
<td align="right">3284.3334</td>
<td align="right">4714.300</td>
<td align="right">3846.105</td>
<td align="right">5461.438</td>
<td align="left">NA</td>
<td align="right">41</td>
<td align="right">24</td>
<td align="right">17</td>
<td align="right">0.0002663</td>
<td align="right">0.0000983</td>
<td align="right">0.0004159</td>
</tr>
<tr class="odd">
<td align="left">False</td>
<td align="left">High</td>
<td align="left">Mascot (B2)</td>
<td align="left">Unambiguous</td>
<td align="left">[KR].iQLWDTAGQER.[FY]</td>
<td align="left">N-Term(TMT6plex)</td>
<td align="right">7</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">O35963</td>
<td align="left">Ras-related protein Rab-33B OS=Mus musculus GN=Rab33b PE=1 SV=1</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">NA</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">515.9459</td>
<td align="right">1545.823</td>
<td align="right">1545.822</td>
<td align="right">0.49</td>
<td align="right">0.00025</td>
<td align="left">CID</td>
<td align="left">MS2</td>
<td align="right">14.174430</td>
<td align="right">5.2</td>
<td align="right">116.000</td>
<td align="right">63.1792</td>
<td align="right">15687</td>
<td align="left">PAMI-176_Mouse_K-T_TMT_40ug_26pctACN_25cm_120min_20160223_OT.raw</td>
<td align="left">F2.5</td>
<td align="right">2202.812</td>
<td align="right">1313.995</td>
<td align="right">1942.837</td>
<td align="right">2381.060</td>
<td align="right">1443.969</td>
<td align="right">1701.8316</td>
<td align="right">968.0946</td>
<td align="right">1867.904</td>
<td align="right">910.823</td>
<td align="right">1371.243</td>
<td align="left">NA</td>
<td align="right">28</td>
<td align="right">28</td>
<td align="right">21</td>
<td align="right">0.0092083</td>
<td align="right">0.0000000</td>
<td align="right">0.0000261</td>
</tr>
<tr class="even">
<td align="left">False</td>
<td align="left">High</td>
<td align="left">Mascot (A2)</td>
<td align="left">Unambiguous</td>
<td align="left">[K].aIDILDR.[SM]</td>
<td align="left">N-Term(TMT6plex)</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">Q61084</td>
<td align="left">Mitogen-activated protein kinase kinase kinase 3 OS=Mus musculus GN=Map3k3 PE=1 SV=1</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">522.8161</td>
<td align="right">1044.625</td>
<td align="right">1044.625</td>
<td align="right">-0.14</td>
<td align="right">-0.00008</td>
<td align="left">CID</td>
<td align="left">MS2</td>
<td align="right">21.614820</td>
<td align="right">19.0</td>
<td align="right">116.000</td>
<td align="right">62.4027</td>
<td align="right">15935</td>
<td align="left">PAMI-194_Mouse_U-Dd_TMT_40ug_26pctACN_25cm_120min_20160426_OT.raw</td>
<td align="left">F3.5</td>
<td align="right">6064.501</td>
<td align="right">3790.208</td>
<td align="right">4328.930</td>
<td align="right">6528.889</td>
<td align="right">6080.098</td>
<td align="right">7705.8087</td>
<td align="right">7836.0572</td>
<td align="right">4606.420</td>
<td align="right">5347.845</td>
<td align="right">5869.469</td>
<td align="left">NA</td>
<td align="right">42</td>
<td align="right">25</td>
<td align="right">18</td>
<td align="right">0.0002350</td>
<td align="right">0.0005618</td>
<td align="right">0.0067230</td>
</tr>
</tbody>
</table>
<p>We also load the <a href="sec-basics.html#sec-annotation_table">annotation table</a>. Each row
in the annotation table contains information for one sample (the table
below shows the first 6 rows).</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="sec-mouse_diet.html#cb304-1" tabindex="-1"></a>coldata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(annotFile)</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="4%">
<col width="5%">
<col width="36%">
<col width="13%">
<col width="10%">
<col width="19%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left">Channel</th>
<th align="left">Condition</th>
<th align="left">Run</th>
<th align="left">BioReplicate</th>
<th align="left">Mixture</th>
<th align="left">Fraction</th>
<th align="right">TechRepMixture</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">126</td>
<td align="left">Long_LF</td>
<td align="left">PAMI-176_Mouse_A-J_TMT_40ug_30pctACN_25cm_120min_20160223_OT.raw</td>
<td align="left">PAMI-176_Mouse_A-J.X126</td>
<td align="left">PAMI-176_Mouse_A-J</td>
<td align="left">40ug_30pctACN_25cm_120min_20160223</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">126</td>
<td align="left">Long_LF</td>
<td align="left">PAMI-176_Mouse_A-J_TMT_40ug_28pctACN_25cm_120min_20160223_OT.raw</td>
<td align="left">PAMI-176_Mouse_A-J.X126</td>
<td align="left">PAMI-176_Mouse_A-J</td>
<td align="left">40ug_28pctACN_25cm_120min_20160223</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">126</td>
<td align="left">Long_LF</td>
<td align="left">PAMI-176_Mouse_A-J_TMT_40ug_90pctACN_25cm_120min_20160223_OT.raw</td>
<td align="left">PAMI-176_Mouse_A-J.X126</td>
<td align="left">PAMI-176_Mouse_A-J</td>
<td align="left">40ug_90pctACN_25cm_120min_20160223</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">126</td>
<td align="left">Long_LF</td>
<td align="left">PAMI-176_Mouse_A-J_TMT_40ug_40pctACN_25cm_120min_20160223_OT.raw</td>
<td align="left">PAMI-176_Mouse_A-J.X126</td>
<td align="left">PAMI-176_Mouse_A-J</td>
<td align="left">40ug_40pctACN_25cm_120min_20160223</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">126</td>
<td align="left">Long_LF</td>
<td align="left">PAMI-176_Mouse_A-J_TMT_40ug_22pctACN_25cm_120min_20160223_OT.raw</td>
<td align="left">PAMI-176_Mouse_A-J.X126</td>
<td align="left">PAMI-176_Mouse_A-J</td>
<td align="left">40ug_22pctACN_25cm_120min_20160223</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">126</td>
<td align="left">Long_LF</td>
<td align="left">PAMI-176_Mouse_A-J_TMT_40ug_24pctACN_25cm_120min_20160223_OT.raw</td>
<td align="left">PAMI-176_Mouse_A-J.X126</td>
<td align="left">PAMI-176_Mouse_A-J</td>
<td align="left">40ug_24pctACN_25cm_120min_20160223</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>We perform a little cleanup of the sample annotations to generate the
information needed for later data modelling, namely</p>
<ol style="list-style-type: decimal">
<li>We extract the diet type from the condition variable.</li>
<li>We extract the diet duration from the condition variable.</li>
<li>We rename the <code>Channel</code> column to <code>Label</code> for more clarity with the
main text.</li>
</ol>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="sec-mouse_diet.html#cb305-1" tabindex="-1"></a>coldata<span class="sc">$</span>Duration <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"_.*"</span>, <span class="st">""</span>, coldata<span class="sc">$</span>Condition) <span class="do">## 1.</span></span>
<span id="cb305-2"><a href="sec-mouse_diet.html#cb305-2" tabindex="-1"></a>coldata<span class="sc">$</span>Diet <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".*_"</span>, <span class="st">""</span>, coldata<span class="sc">$</span>Condition) <span class="do">## 2.</span></span>
<span id="cb305-3"><a href="sec-mouse_diet.html#cb305-3" tabindex="-1"></a><span class="fu">colnames</span>(coldata)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"Label"</span> <span class="do">## 3.</span></span></code></pre></div>
<p>We will also subset the data set to reduce computational costs. If you
want to run the vignette on the full data set, you can skip this
chunk. We here randomly sample 500 proteins from the experiment.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="sec-mouse_diet.html#cb306-1" tabindex="-1"></a>proteinIds <span class="ot">&lt;-</span> <span class="fu">unique</span>(psms<span class="sc">$</span>Protein.Accessions)</span>
<span id="cb306-2"><a href="sec-mouse_diet.html#cb306-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb306-3"><a href="sec-mouse_diet.html#cb306-3" tabindex="-1"></a>psms <span class="ot">&lt;-</span> psms[psms<span class="sc">$</span>Protein.Accessions <span class="sc">%in%</span> <span class="fu">sample</span>(proteinIds, <span class="dv">500</span>), ]</span></code></pre></div>
</div>
<div id="the-qfeatures-data-class-2" class="section level3" number="7.3.3">
<h3>
<span class="header-section-number">7.3.3</span> The <code>QFeatures</code> data class<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('the-qfeatures-data-class-2')" onmouseout="reset_tooltip('the-qfeatures-data-class-2-tooltip')"><span class="tooltiptext" id="the-qfeatures-data-class-2-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>We combine the two tables into a <a href="sec-basics.html#sec-qfeatures"><code>QFeatures</code> object</a>.
We need to point to the column containing the run information. For the
annotation table, this is simply the <code>Run</code> column. For the Skyline
table, this is the <code>Spectrum.File</code> column. We also add a <code>quantCols</code>
column in the annotation table. We also simply the run names upon
conversion for conciseness.</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="sec-mouse_diet.html#cb307-1" tabindex="-1"></a>coldata<span class="sc">$</span>runCol <span class="ot">&lt;-</span> coldata<span class="sc">$</span>Run</span>
<span id="cb307-2"><a href="sec-mouse_diet.html#cb307-2" tabindex="-1"></a>coldata<span class="sc">$</span>quantCols <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Abundance.."</span>, coldata<span class="sc">$</span>Label)</span>
<span id="cb307-3"><a href="sec-mouse_diet.html#cb307-3" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">readQFeatures</span>(psms, <span class="at">colData =</span> coldata,</span>
<span id="cb307-4"><a href="sec-mouse_diet.html#cb307-4" tabindex="-1"></a>                       <span class="at">quantCols =</span> <span class="fu">unique</span>(coldata<span class="sc">$</span>quantCols),</span>
<span id="cb307-5"><a href="sec-mouse_diet.html#cb307-5" tabindex="-1"></a>                       <span class="at">runCol =</span> <span class="st">"Spectrum.File"</span>, <span class="at">name =</span> <span class="st">"psms"</span>)</span>
<span id="cb307-6"><a href="sec-mouse_diet.html#cb307-6" tabindex="-1"></a><span class="fu">names</span>(mouse) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^.*(Mouse.*ACN).*raw"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="fu">names</span>(mouse))</span>
<span id="cb307-7"><a href="sec-mouse_diet.html#cb307-7" tabindex="-1"></a>mouse</span></code></pre></div>
<pre><code>## An instance of class QFeatures (type: bulk) with 27 sets:
## 
##  [1] Mouse_A-J_TMT_40ug_14pctACN: SummarizedExperiment with 198 rows and 10 columns 
##  [2] Mouse_A-J_TMT_40ug_20pctACN: SummarizedExperiment with 481 rows and 10 columns 
##  [3] Mouse_A-J_TMT_40ug_22pctACN: SummarizedExperiment with 514 rows and 10 columns 
##  ...
##  [25] Mouse_U-Dd_TMT_40ug_30pctACN: SummarizedExperiment with 726 rows and 10 columns 
##  [26] Mouse_U-Dd_TMT_40ug_40pctACN: SummarizedExperiment with 566 rows and 10 columns 
##  [27] Mouse_U-Dd_TMT_40ug_90pctACN: SummarizedExperiment with 251 rows and 10 columns</code></pre>
<p>We now have a <code>QFeatures</code> object with 27 sets, each containing data
associated with an MS run. The</p>
</div>
</div>
<div id="data-preprocessing-4" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> Data preprocessing<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('data-preprocessing-4')" onmouseout="reset_tooltip('data-preprocessing-4-tooltip')"><span class="tooltiptext" id="data-preprocessing-4-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p><code>msqrob2</code> relies on the <code>QFeatures</code> data structure, meaning that we
can directly make use of <code>QFeatures</code>’ data preprocessing
functionality (see also the <code>QFeatures</code>
<a href="https://rformassspectrometry.github.io/QFeatures/articles/Processing.html">documentation</a>).</p>
<div id="encoding-missing-values-3" class="section level3" number="7.4.1">
<h3>
<span class="header-section-number">7.4.1</span> Encoding missing values<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('encoding-missing-values-3')" onmouseout="reset_tooltip('encoding-missing-values-3-tooltip')"><span class="tooltiptext" id="encoding-missing-values-3-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>Peptides with zero intensities are missing peptides and should be
represent with a <code>NA</code> value rather than <code>0</code> (see <a href="sec-basics.html#sec-encode_missing">Encoding missing
values</a>).</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="sec-mouse_diet.html#cb309-1" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">zeroIsNA</span>(mouse, <span class="fu">names</span>(mouse))</span></code></pre></div>
</div>
<div id="sample-filtering-1" class="section level3" number="7.4.2">
<h3>
<span class="header-section-number">7.4.2</span> Sample filtering<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('sample-filtering-1')" onmouseout="reset_tooltip('sample-filtering-1-tooltip')"><span class="tooltiptext" id="sample-filtering-1-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>We remove the reference samples that were used by the MSstatsTMT
authors to obtain normalisation factors since msqrob2TMT workflows do
not require normalisation from reference label. The information
about which samples are normalisation samples is available from the
<code>colData</code>, in the <code>Condition</code> column.</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="sec-mouse_diet.html#cb310-1" tabindex="-1"></a><span class="fu">table</span>(mouse<span class="sc">$</span>Condition)</span></code></pre></div>
<pre><code>## 
##  Long_HF  Long_LF   Long_M     Norm Short_HF Short_LF 
##       45       45       36       54       45       45</code></pre>
<p>We remove any sample that is marked as <code>Norm</code>. We also remove sample
that are annotated as <code>Long_M</code> since we could not find documentation
for this group.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="sec-mouse_diet.html#cb312-1" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">subsetByColData</span>(</span>
<span id="cb312-2"><a href="sec-mouse_diet.html#cb312-2" tabindex="-1"></a>    mouse, mouse<span class="sc">$</span>Condition <span class="sc">!=</span> <span class="st">"Norm"</span> <span class="sc">&amp;</span> mouse<span class="sc">$</span>Condition <span class="sc">!=</span> <span class="st">"Long_M"</span></span>
<span id="cb312-3"><a href="sec-mouse_diet.html#cb312-3" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="psm-filtering-2" class="section level3" number="7.4.3">
<h3>
<span class="header-section-number">7.4.3</span> PSM filtering<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('psm-filtering-2')" onmouseout="reset_tooltip('psm-filtering-2-tooltip')"><span class="tooltiptext" id="psm-filtering-2-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>We <a href="sec-basics.html#sec-filter">filter features</a> for which more than 70% of the
intensities are missing in a run. We keep the spectrum as soon as the
reporter ions are observed in at least 3 out of 10 TMT labels of the
run (same cut-off as applied in <span class="citation">Huang et al. (<label for="tufte-mn-21" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-21" class="margin-toggle">2020<span class="marginnote">Huang, Ting, Meena Choi, Manuel Tzouros, Sabrina Golling, Nikhil Janak Pandya, Balazs Banfai, Tom Dunkley, and Olga Vitek. 2020. <span>“<span>MSstatsTMT</span>: Statistical Detection of Differentially Abundant Proteins in Experiments with Isobaric Labeling and Multiple Mixtures.”</span> <em>Mol. Cell. Proteomics</em> 19 (10): 1706–23.</span>)</span>).</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="sec-mouse_diet.html#cb313-1" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">filterNA</span>(mouse, <span class="fu">names</span>(mouse), <span class="at">pNA =</span> <span class="fl">0.7</span>) <span class="do">## 2.</span></span></code></pre></div>
<p>We next remove PSMs that could not be mapped to a protein or that map
to multiple proteins (the protein identifier contains multiple
identifiers separated by a <code>;</code>). We use <code>filterFeatures()</code> that will
keep the row that fulfill the condition below. Note that
<code>Protein.Accessions</code> is a column generated by Skyline that is
available in the <code>rowData</code>.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="sec-mouse_diet.html#cb314-1" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(</span>
<span id="cb314-2"><a href="sec-mouse_diet.html#cb314-2" tabindex="-1"></a>    mouse, <span class="sc">~</span> Protein.Accessions <span class="sc">!=</span> <span class="st">""</span> <span class="sc">&amp;</span> <span class="do">## Remove failed protein inference</span></span>
<span id="cb314-3"><a href="sec-mouse_diet.html#cb314-3" tabindex="-1"></a>        <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">";"</span>, Protein.Accessions)) <span class="do">## Remove protein groups</span></span></code></pre></div>
<p>Peptide ions that were identified with multiple PSMs in a run are
collapsed to the PSM with the highest summed intensity over the
labels, a strategy that is also used by MSstats. We will again use
<code>filterFeatures()</code>, but the highest summed intensity for each PSM
is not available in the <code>rowData</code>, so we need to create it manually.</p>
<p>We therefore loop over each set:</p>
<ol style="list-style-type: decimal">
<li>Make a new variable for ionID in the <code>rowData</code>, which is defined as
the peptide sequence and its charge.</li>
<li>We calculate the <code>rowSums</code> for each ion.</li>
<li>Make a new variable <code>psmRank</code> that ranks the PSMs for each ion
based on the summed intensity.</li>
<li>We store the new information back in the <code>rowData</code>.</li>
<li>We keep the PSM with the highest summed intensity, that is that
ranks first (note that PSM unique to an ion will always rank
first).</li>
</ol>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="sec-mouse_diet.html#cb315-1" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">names</span>(mouse)) {</span>
<span id="cb315-2"><a href="sec-mouse_diet.html#cb315-2" tabindex="-1"></a>    rowdata <span class="ot">&lt;-</span> <span class="fu">rowData</span>(mouse[[i]])</span>
<span id="cb315-3"><a href="sec-mouse_diet.html#cb315-3" tabindex="-1"></a>    rowdata<span class="sc">$</span>ionID <span class="ot">&lt;-</span> <span class="fu">paste0</span>(rowdata<span class="sc">$</span>Annotated.Sequence, rowdata<span class="sc">$</span>Charge) <span class="do">## 1.</span></span>
<span id="cb315-4"><a href="sec-mouse_diet.html#cb315-4" tabindex="-1"></a>    rowdata<span class="sc">$</span>rowSums <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">assay</span>(mouse[[i]]), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="do">## 2.</span></span>
<span id="cb315-5"><a href="sec-mouse_diet.html#cb315-5" tabindex="-1"></a>    rowdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(rowdata) <span class="sc">|&gt;</span></span>
<span id="cb315-6"><a href="sec-mouse_diet.html#cb315-6" tabindex="-1"></a>        <span class="fu">group_by</span>(ionID) <span class="sc">|&gt;</span></span>
<span id="cb315-7"><a href="sec-mouse_diet.html#cb315-7" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">psmRank =</span> <span class="fu">rank</span>(<span class="sc">-</span>rowSums)) <span class="do">## 3.</span></span>
<span id="cb315-8"><a href="sec-mouse_diet.html#cb315-8" tabindex="-1"></a>    <span class="fu">rowData</span>(mouse[[i]]) <span class="ot">&lt;-</span> <span class="fu">DataFrame</span>(rowdata) <span class="do">## 4.</span></span>
<span id="cb315-9"><a href="sec-mouse_diet.html#cb315-9" tabindex="-1"></a>}</span>
<span id="cb315-10"><a href="sec-mouse_diet.html#cb315-10" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(mouse, <span class="sc">~</span> psmRank <span class="sc">==</span> <span class="dv">1</span>) <span class="do">## 5.</span></span></code></pre></div>
<p>So, we implicitly collapsed the PSM-level data into <strong>peptide-ion</strong>
data, where each row represents a PSM, but also a unique ion within a
run. So we will refer to the data as “ion-level”.</p>
</div>
<div id="standard-preprocessing-workflow-2" class="section level3" number="7.4.4">
<h3>
<span class="header-section-number">7.4.4</span> Standard preprocessing workflow<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('standard-preprocessing-workflow-2')" onmouseout="reset_tooltip('standard-preprocessing-workflow-2-tooltip')"><span class="tooltiptext" id="standard-preprocessing-workflow-2-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>We can now prepare the data for modelling. The workflow ensures the
data complies to <code>msqrob2</code>’s requirements:</p>
<ol style="list-style-type: decimal">
<li>Intensities are log-transformed.</li>
<li>Samples are normalised.</li>
<li>(optionally) PSMs intensities are summarised into protein abundance
values for protein-level workflows.</li>
</ol>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="sec-mouse_diet.html#cb316-1" tabindex="-1"></a>sNames <span class="ot">&lt;-</span> <span class="fu">names</span>(mouse)</span>
<span id="cb316-2"><a href="sec-mouse_diet.html#cb316-2" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">logTransform</span>( <span class="do">## 1.</span></span>
<span id="cb316-3"><a href="sec-mouse_diet.html#cb316-3" tabindex="-1"></a>    mouse, sNames, <span class="at">name =</span> <span class="fu">paste0</span>(sNames, <span class="st">"_log"</span>), <span class="at">base =</span> <span class="dv">2</span></span>
<span id="cb316-4"><a href="sec-mouse_diet.html#cb316-4" tabindex="-1"></a>)</span>
<span id="cb316-5"><a href="sec-mouse_diet.html#cb316-5" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">normalize</span>( <span class="do">## 2.</span></span>
<span id="cb316-6"><a href="sec-mouse_diet.html#cb316-6" tabindex="-1"></a>    mouse, <span class="fu">paste0</span>(sNames, <span class="st">"_log"</span>), <span class="at">name =</span> <span class="fu">paste0</span>(sNames, <span class="st">"_norm"</span>),</span>
<span id="cb316-7"><a href="sec-mouse_diet.html#cb316-7" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"center.median"</span></span>
<span id="cb316-8"><a href="sec-mouse_diet.html#cb316-8" tabindex="-1"></a>)</span>
<span id="cb316-9"><a href="sec-mouse_diet.html#cb316-9" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">aggregateFeatures</span>( <span class="do">## 3.</span></span>
<span id="cb316-10"><a href="sec-mouse_diet.html#cb316-10" tabindex="-1"></a>    mouse, <span class="at">i =</span> <span class="fu">paste0</span>(sNames, <span class="st">"_norm"</span>), <span class="at">name =</span> <span class="fu">paste0</span>(sNames, <span class="st">"_proteins"</span>),</span>
<span id="cb316-11"><a href="sec-mouse_diet.html#cb316-11" tabindex="-1"></a>    <span class="at">fcol =</span> <span class="st">"Protein.Accessions"</span>, <span class="at">fun =</span> MsCoreUtils<span class="sc">::</span>medianPolish,</span>
<span id="cb316-12"><a href="sec-mouse_diet.html#cb316-12" tabindex="-1"></a>    <span class="at">na.rm=</span><span class="cn">TRUE</span></span>
<span id="cb316-13"><a href="sec-mouse_diet.html#cb316-13" tabindex="-1"></a>)</span></code></pre></div>
<p>We conclude the preprocessing by joining the assays of the different
runs in a single ion set for ion-level models. In order to correctly
match peptide ions across rus, we use <code>ionID</code> as a row identifier.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="sec-mouse_diet.html#cb317-1" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">joinAssays</span>(mouse, <span class="fu">paste0</span>(sNames, <span class="st">"_norm"</span>), <span class="at">fcol =</span> <span class="st">"ionID"</span>, <span class="st">"ions_norm"</span>)</span></code></pre></div>
<p>We also join the protein sets for protein-level models. We omit <code>fcol</code>
and will merge rows based on their row name (protein identifier).</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="sec-mouse_diet.html#cb318-1" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">joinAssays</span>(mouse, <span class="fu">paste0</span>(sNames, <span class="st">"_proteins"</span>), <span class="st">"proteins"</span>)</span></code></pre></div>
</div>
</div>
<div id="data-exploration-3" class="section level2" number="7.5">
<h2>
<span class="header-section-number">7.5</span> Data exploration<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('data-exploration-3')" onmouseout="reset_tooltip('data-exploration-3-tooltip')"><span class="tooltiptext" id="data-exploration-3-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>As <a href="sec-mouse_diet.html#sec-exp_design_mouse">described above</a>, the samples originate from mice
that were either subject to a low-fat (<code>LF</code>) or high-fat (<code>HF</code>) diet.
Moreover, each of the diet was maintained for a short duration
(<code>Short</code>) or a long duration (<code>Long</code>). Note that each group contains 5
mice but the peptides from each sample have been fractionated in 9
fractions, leading to 45 units per group.</p>
<p>In this case, we are interested in the effects of diet type and the
effect of diet duration. The table below confirms we have a balanced
design for each condition.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="sec-mouse_diet.html#cb319-1" tabindex="-1"></a><span class="fu">table</span>(<span class="at">Diet =</span> mouse<span class="sc">$</span>Diet, <span class="at">Duration =</span> mouse<span class="sc">$</span>Duration)</span></code></pre></div>
<pre><code>##     Duration
## Diet Long Short
##   HF   45    45
##   LF   45    45</code></pre>
<p>Furthermore, there are potential unwanted sources of variation: the
experimental unit (i.e. the mouse, <code>BioReplicate</code>), the fraction
(<code>Fraction</code>), the run (<code>Run</code>), the TMT mixture (<code>Mixture</code>).</p>
<p>We will explore the main sources of variation in the
data using (see <a href="sec-basics.html#sec_data_exploration">Data exploration</a>). Unfortunately, the peptide ion
data contains too many missing values and cannot be explored using
standard dimension reduction approaches. <code>omicsGMF</code> <span class="citation">(<label for="tufte-mn-22" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-22" class="margin-toggle">Segers et al. 2025<span class="marginnote">Segers, Alexandre, Cristian Castiglione, Christophe Vanderaa, Elfride De Baere, Lennart Martens, Davide Risso, and Lieven Clement. 2025. <span>“<span class="nocase">omicsGMF</span>: A Multi-Tool for Dimensionality Reduction, Batch Correction and Imputation Applied to Bulk- and Single Cell Proteomics Data.”</span> <em>bioRxiv</em>, March, 2025.03.24.644996.</span>)</span>
provides an interesting alternative, but is still in its early stage
and will not be included here. We will therefore run a MDS analysis on
the protein-level data instead, which contains less missing values.</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="sec-mouse_diet.html#cb321-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"scater"</span>)</span>
<span id="cb321-2"><a href="sec-mouse_diet.html#cb321-2" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">getWithColData</span>(mouse, <span class="st">"proteins"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb321-3"><a href="sec-mouse_diet.html#cb321-3" tabindex="-1"></a>  <span class="fu">as</span>(<span class="st">"SingleCellExperiment"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb321-4"><a href="sec-mouse_diet.html#cb321-4" tabindex="-1"></a>  <span class="fu">runMDS</span>(<span class="at">exprs_values =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>We can now plot the MDS and colour each sample based on different
potential sources of variation.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="sec-mouse_diet.html#cb322-1" tabindex="-1"></a><span class="fu">plotMDS</span>(se, <span class="at">colour_by =</span> <span class="st">"Run"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Coloured by Run"</span>) <span class="sc">+</span></span>
<span id="cb322-2"><a href="sec-mouse_diet.html#cb322-2" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">rainbow</span>(<span class="dv">27</span>)) <span class="sc">+</span></span>
<span id="cb322-3"><a href="sec-mouse_diet.html#cb322-3" tabindex="-1"></a>  <span class="fu">plotMDS</span>(se, <span class="at">colour_by =</span> <span class="st">"Fraction"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Coloured by Fraction"</span>) <span class="sc">+</span></span>
<span id="cb322-4"><a href="sec-mouse_diet.html#cb322-4" tabindex="-1"></a>  <span class="fu">plotMDS</span>(se, <span class="at">colour_by =</span> <span class="st">"BioReplicate"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Coloured by BioReplicate"</span>) <span class="sc">+</span></span>
<span id="cb322-5"><a href="sec-mouse_diet.html#cb322-5" tabindex="-1"></a>  <span class="fu">plotMDS</span>(se, <span class="at">colour_by =</span> <span class="st">"Mixture"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Coloured by Mixture"</span>) <span class="sc">+</span></span>
<span id="cb322-6"><a href="sec-mouse_diet.html#cb322-6" tabindex="-1"></a>  <span class="fu">plotMDS</span>(se, <span class="at">colour_by =</span> <span class="st">"Diet"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Coloured by Diet"</span>) <span class="sc">+</span></span>
<span id="cb322-7"><a href="sec-mouse_diet.html#cb322-7" tabindex="-1"></a>  <span class="fu">plotMDS</span>(se, <span class="at">colour_by =</span> <span class="st">"Duration"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Coloured by Duration"</span>) <span class="sc">&amp;</span></span>
<span id="cb322-8"><a href="sec-mouse_diet.html#cb322-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span></code></pre></div>
<div class="float">
<img src="figure/unnamed-chunk-24-1.png" alt="plot of chunk unnamed-chunk-24"><div class="figcaption">plot of chunk unnamed-chunk-24</div>
</div>
<p>The data exploration leads to several observations:</p>
<ul>
<li>The strongest source of variation is associated with the MS
acquisition run.</li>
<li>Part of this run effect is influenced by which fraction it contains
since samples from the same fraction tend to be closer than samples from different
fractions.</li>
<li>It is difficult to identify an effect of mouse (biological
replicate) because every run contains distinct mice. However, this
does not exclude an effect of mice which has been identified as a
potential source of variation and hence should still be modelled.</li>
<li>There is potentially also an effect of TMT mixture since samples
from the same mixtures tend to cluster together (in the center of
the plot). However, this effect are more subtle to detect and
difficult to disentangle from the run and fraction effects.</li>
<li>Although again very subtle, we can see within each run that samples
from the mice with the same diet tends to group together. However,
these effects are overwhelmed by the run effects. An effect of
duration is to subtle to pinpoint from the current data exploration.</li>
</ul>
<p>Data modelling disentangles the different sources of variation, given
their are properly defined in the model, hence the next section.</p>
</div>
<div id="data-modelling-3" class="section level2" number="7.6">
<h2>
<span class="header-section-number">7.6</span> Data modelling<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('data-modelling-3')" onmouseout="reset_tooltip('data-modelling-3-tooltip')"><span class="tooltiptext" id="data-modelling-3-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>The preprocessed data can now be modelled to answer biologically
relevant questions.</p>
<div id="sources-of-variation-2" class="section level3" number="7.6.1">
<h3>
<span class="header-section-number">7.6.1</span> Sources of variation<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('sources-of-variation-2')" onmouseout="reset_tooltip('sources-of-variation-2-tooltip')"><span class="tooltiptext" id="sources-of-variation-2-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>Proteomics data contain several sources of variation that need to be
accounted for by the model:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Treatment of interest</strong>: we model the source of variation induced
by the experimental treatment of interest as a <strong>fixed effect</strong>.
Fixed effects are effect that are considered non-random, i.e. the
treatment effect is assumed to be the same and reproducible across
repeated experiments, but it is unknown and has to be estimated. We
will include <code>Diet</code> as a fixed effect that models the fact that a
change in diet type can induce changes in protein abundance.
Similarly, we also include <code>Duration</code> as a fixed effect to model
the change in protein abundance induces by the diet duration.
Finally, we will also include an interaction between the two
variables allowing that the changes in protein abundance induced by
diet type can be different whether the mice were fed for a short or
long duration.</p></li>
<li><p><strong>Biological replicate effect</strong>: the experiment involves biological
replication as the adipose tissue extracts were sampled from 20
mice (5 mice per Diet x Duration combination). Replicate-specific
effects occurs due to uncontrollable factors, such as social
behavior, feeding behavior, physical activity, occasional
injury,… Two mice will never provide exactly the same sample material,
even were they genetically identical and manipulated identically.
These effects are typically modelled as random effects which are
considered as a random sample from the population of all possible
mice and are assumed to be i.i.d normally distributed with mean 0
and constant variance, <span class="math inline">\(u_{mouse} \sim
N(0,\sigma^{2,\text{mouse}})\)</span>. The use of random effects thus
models the correlation in the data, explicitly. We expect that
intensities from the same mouse are more alike than intensities
between mice.</p></li>
</ol>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="sec-mouse_diet.html#cb323-1" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(mouse<span class="sc">$</span>BioReplicate))</span></code></pre></div>
<pre><code>## [1] 20</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>
<strong>Labelling effects</strong>: the 20 mouse adipose tissue samples have been
labelled using 18-plex TMT. We can expect that samples measured
within the same TMT label may be more similar than samples
measured within different TMT labels. Since these effects may not
be reproducible from one experiment to another, for instance
because each TMT kit may potentially contain different impurity
ratios, we can account for this correlation using a random effect
for TMT label.</li>
</ol>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="sec-mouse_diet.html#cb325-1" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(mouse<span class="sc">$</span>Label))</span></code></pre></div>
<pre><code>## [1] 10</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>
<strong>Mixture effects</strong>: the 20 mouse samples were assigned to one out
of 3 mixtures. Again, we expect protein intensities from the same
mixture will be more alike than those of different mixtures. Hence,
we will add a random effect for mixture.</li>
</ol>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="sec-mouse_diet.html#cb327-1" tabindex="-1"></a><span class="fu">table</span>(mouse<span class="sc">$</span>Mixture)</span></code></pre></div>
<pre><code>## 
##  PAMI-176_Mouse_A-J  PAMI-176_Mouse_K-T PAMI-194_Mouse_U-Dd 
##                  54                  63                  63</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>
<strong>Run effects</strong>: protein intensities that are measured within the
same run will be more similar than protein intensities between
runs. We will use a random effect for run to explicitly model this
correlation in the data. Note that each sample has been acquired in
9 fractions, each fraction being measured in a separate run.
Accounting for the effects of run will also absorb the effects of
fraction.</li>
</ol>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="sec-mouse_diet.html#cb329-1" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(mouse<span class="sc">$</span>Run))</span></code></pre></div>
<pre><code>## [1] 27</code></pre>
<ol start="6" style="list-style-type: decimal">
<li><p><strong>Spectrum effects</strong>: we will directly estimate the treatment effect
at the protein-level from ion-level data. This will again induce
additional levels of correlation. The intensities for the different
TMT labels in the same spectrum (PSM) within a run will be
more similar than the intensities between spectra. We therefore
need to add a random effect term to account for the within specrum
correlation structure. Note that a spectrum here contains the data
from one peptide ion within a run. Hence, modelling a random effect
for spectrum boils down to modelling a random effect for peptide
ion nested within run.</p></li>
<li><p><strong>Labelling effects nested in run</strong>: modelling the data at the
ion-level also implies that a label in a run contains multiple
ion intensities for each protein. Hence, intensities from different
peptide ions for a protein with the same label within a run will be
more alike than intensities of different PSMs for the same protein
with different labels and/or runs, and we will address this
correlation with a random effect for label nested in run.</p></li>
</ol>
<p><code>msqrob2</code> workflows rely on linear mixed models, which are models that
can estimate and predict fixed and random effects, respectively.</p>
<p>Now we have identified the sources of variation, we can define a
model. We will model the main effects for <code>Diet</code> and <code>Duration</code>, and a
<code>Diet:Duration</code> interaction, to account for proteins for which the
<code>Diet</code> effect changes according to <code>Duration</code>, and vice versa, which
can be written as <code>Diet + Duration + Diet:Duration</code>, shortened into
<code>Diet * Duration</code>. Adding the technical sources of variation, the
model becomes.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="sec-mouse_diet.html#cb331-1" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="er">~</span> Diet <span class="sc">*</span> Duration <span class="sc">+</span> <span class="do">## (1) fixed effect for Diet and Duration with interaction</span></span>
<span id="cb331-2"><a href="sec-mouse_diet.html#cb331-2" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">|</span> BioReplicate) <span class="sc">+</span>  <span class="do">## (2) random effect for biological replicate (mouse)      </span></span>
<span id="cb331-3"><a href="sec-mouse_diet.html#cb331-3" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">|</span> Label) <span class="sc">+</span> <span class="do">## (3) random effect for label</span></span>
<span id="cb331-4"><a href="sec-mouse_diet.html#cb331-4" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">|</span> Mixture) <span class="sc">+</span> <span class="do">## (4) random effect for mixture</span></span>
<span id="cb331-5"><a href="sec-mouse_diet.html#cb331-5" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">|</span> Run) <span class="sc">+</span> <span class="do">## (5) random effect for MS run</span></span>
<span id="cb331-6"><a href="sec-mouse_diet.html#cb331-6" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">|</span> Run<span class="sc">:</span>ionID) <span class="sc">+</span> <span class="do">## (6) random effect for spectrum, i.e. ionID nested in run</span></span>
<span id="cb331-7"><a href="sec-mouse_diet.html#cb331-7" tabindex="-1"></a>  (<span class="dv">1</span> <span class="sc">|</span> Run<span class="sc">:</span>Label)  <span class="do">## (7) random effect for label nested in MS run</span></span></code></pre></div>
<p>We can run the <code>msqrob2</code> statistical workflow.</p>
</div>
<div id="model-estimation" class="section level3" number="7.6.2">
<h3>
<span class="header-section-number">7.6.2</span> Model estimation<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('model-estimation')" onmouseout="reset_tooltip('model-estimation-tooltip')"><span class="tooltiptext" id="model-estimation-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>We estimate the peptide-ion-level model with <code>msqrobAggregate()</code>
(see <a href="sec-advanced.html#sec-run_model">the modelling section</a>). Recall that
variables defined in <code>model</code> are automatically retrieved from the
<code>colData</code> (<code>"Diet"</code>, <code>"Duration"</code>, <code>"Label"</code>, <code>"Mixture"</code>) and
from the <code>rowData</code> (<code>"ionID"</code>). We also enable M-estimation
(<code>robust = TRUE</code>) for improved robustness against outliers and ridge
penalisation (<code>ridge = TRUE</code>) to stabilise the parameter estimation.</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="sec-mouse_diet.html#cb332-1" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">msqrobAggregate</span>(</span>
<span id="cb332-2"><a href="sec-mouse_diet.html#cb332-2" tabindex="-1"></a>    mouse, <span class="at">i =</span> <span class="st">"ions_norm"</span>,</span>
<span id="cb332-3"><a href="sec-mouse_diet.html#cb332-3" tabindex="-1"></a>    <span class="at">formula =</span> model,</span>
<span id="cb332-4"><a href="sec-mouse_diet.html#cb332-4" tabindex="-1"></a>    <span class="at">fcol =</span> <span class="st">"Protein.Accessions"</span>,</span>
<span id="cb332-5"><a href="sec-mouse_diet.html#cb332-5" tabindex="-1"></a>    <span class="at">modelColumnName =</span> <span class="st">"msqrob_ion"</span>,</span>
<span id="cb332-6"><a href="sec-mouse_diet.html#cb332-6" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"proteins_msqrob"</span>,</span>
<span id="cb332-7"><a href="sec-mouse_diet.html#cb332-7" tabindex="-1"></a>    <span class="at">ridge =</span> <span class="cn">TRUE</span>, <span class="at">robust =</span> <span class="cn">TRUE</span></span>
<span id="cb332-8"><a href="sec-mouse_diet.html#cb332-8" tabindex="-1"></a>)</span></code></pre></div>
<p>Once the model is estimated, we can start answering biological
questions.</p>
</div>
<div id="hypothesis-testing-3" class="section level3" number="7.6.3">
<h3>
<span class="header-section-number">7.6.3</span> Hypothesis testing<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('hypothesis-testing-3')" onmouseout="reset_tooltip('hypothesis-testing-3-tooltip')"><span class="tooltiptext" id="hypothesis-testing-3-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>In this section, you will learn how to convert a biological question
into a statistical hypothesis.</p>
<div id="difference-between-low-fat-and-high-fat-diet-after-short-duration" class="section level4" number="7.6.3.1">
<h4>
<span class="header-section-number">7.6.3.1</span> Difference between low fat and high fat diet after short duration</h4>
<p>A first question one can ask is: how are protein abundance affected by
diet when only considering a short diet duration? We need to convert
this question in a combination of the model parameters, also referred
to as a contrast. To aid defining contrasts, we will visualise the
experimental design using the <code>ExploreModelMatrix</code> package. Since we
are not interested in technical effects, we will only focus on the
variables of interest, here <code>Diet * Duration</code>.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="sec-mouse_diet.html#cb333-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ExploreModelMatrix"</span>)</span>
<span id="cb333-2"><a href="sec-mouse_diet.html#cb333-2" tabindex="-1"></a>vd <span class="ot">&lt;-</span> <span class="fu">VisualizeDesign</span>(</span>
<span id="cb333-3"><a href="sec-mouse_diet.html#cb333-3" tabindex="-1"></a>    <span class="at">sampleData =</span>  <span class="fu">colData</span>(mouse),</span>
<span id="cb333-4"><a href="sec-mouse_diet.html#cb333-4" tabindex="-1"></a>    <span class="at">designFormula =</span> <span class="sc">~</span> Diet <span class="sc">*</span> Duration,</span>
<span id="cb333-5"><a href="sec-mouse_diet.html#cb333-5" tabindex="-1"></a>    <span class="at">textSizeFitted =</span> <span class="dv">4</span></span>
<span id="cb333-6"><a href="sec-mouse_diet.html#cb333-6" tabindex="-1"></a>)</span>
<span id="cb333-7"><a href="sec-mouse_diet.html#cb333-7" tabindex="-1"></a>vd<span class="sc">$</span>plotlist[[<span class="dv">1</span>]]</span></code></pre></div>
<div class="float">
<img src="figure/unnamed-chunk-30-1.png" alt="plot of chunk unnamed-chunk-30"><div class="figcaption">plot of chunk unnamed-chunk-30</div>
</div>
<p>Assessing the difference between low-fat and high-fat diets for short
duration boils down to assessing the difference between the <code>Short_LF</code> and
<code>Short_HF</code>. The mean for the short low-fat diet group is defined by
<code>(Intercept) + DietLF + DurationShort + DietLF:DurationShort</code>. The
mean for the short high-fat diet group is defined by <code>(Intercept) + DurationShort</code>. The difference between the two results in the
contrast below:</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="sec-mouse_diet.html#cb334-1" tabindex="-1"></a>contrast <span class="ot">&lt;-</span> <span class="st">"ridgeDietLF + ridgeDietLF:DurationShort"</span></span></code></pre></div>
<p>Note that because we used ridge regression for modelling, we need to
prefix the parameter names with <code>ridge</code>. We can further specify the
null hypothesis, that is we are interest whether the differences
between the two groups is different from zero.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="sec-mouse_diet.html#cb335-1" tabindex="-1"></a>(hypothesis1 <span class="ot">&lt;-</span> <span class="fu">paste</span>(contrast, <span class="st">"= 0"</span>))</span></code></pre></div>
<pre><code>## [1] "ridgeDietLF + ridgeDietLF:DurationShort = 0"</code></pre>
<p>We next use <code>makeContrast()</code> to build a contrast matrix.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="sec-mouse_diet.html#cb337-1" tabindex="-1"></a>(L <span class="ot">&lt;-</span> <span class="fu">makeContrast</span>(</span>
<span id="cb337-2"><a href="sec-mouse_diet.html#cb337-2" tabindex="-1"></a>    hypothesis1,</span>
<span id="cb337-3"><a href="sec-mouse_diet.html#cb337-3" tabindex="-1"></a>    <span class="at">parameterNames =</span> <span class="fu">c</span>(<span class="st">"ridgeDietLF"</span>,<span class="st">"ridgeDurationShort"</span>,<span class="st">"ridgeDietLF:DurationShort"</span>)</span>
<span id="cb337-4"><a href="sec-mouse_diet.html#cb337-4" tabindex="-1"></a>))</span></code></pre></div>
<pre><code>##                           ridgeDietLF + ridgeDietLF:DurationShort
## ridgeDietLF                                                     1
## ridgeDurationShort                                              0
## ridgeDietLF:DurationShort                                       1</code></pre>
<p>We can now test our null hypothesis.</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="sec-mouse_diet.html#cb339-1" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">hypothesisTest</span>(</span>
<span id="cb339-2"><a href="sec-mouse_diet.html#cb339-2" tabindex="-1"></a>    mouse, <span class="at">i =</span> <span class="st">"proteins_msqrob"</span>, L, <span class="at">modelColumn =</span> <span class="st">"msqrob_ion"</span></span>
<span id="cb339-3"><a href="sec-mouse_diet.html#cb339-3" tabindex="-1"></a>)</span></code></pre></div>
<p>Let us retrieve the result table from the <code>rowData</code>. Note that the
model column is named after the column names of the contrast matrix <code>L</code>.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="sec-mouse_diet.html#cb340-1" tabindex="-1"></a>inference <span class="ot">&lt;-</span> <span class="fu">rowData</span>(mouse[[<span class="st">"proteins_msqrob"</span>]])[[<span class="fu">colnames</span>(L)]]</span>
<span id="cb340-2"><a href="sec-mouse_diet.html#cb340-2" tabindex="-1"></a>inference<span class="sc">$</span>Protein <span class="ot">&lt;-</span> <span class="fu">rownames</span>(inference)</span>
<span id="cb340-3"><a href="sec-mouse_diet.html#cb340-3" tabindex="-1"></a><span class="fu">head</span>(inference, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##                logFC           se       df             t      pval adjPval
## A2AJB7  3.491872e-09 9.284189e-05 67.35093  3.761096e-05 0.9999701       1
## A2AJK6            NA           NA       NA            NA        NA      NA
## A2AQP0            NA           NA       NA            NA        NA      NA
## A2AWP8            NA           NA       NA            NA        NA      NA
## A6H8H2            NA           NA       NA            NA        NA      NA
## B1AVY7            NA           NA       NA            NA        NA      NA
## B2RSH2  2.296647e-09 8.045105e-05 52.17788  2.854713e-05 0.9999773       1
## C0HKD8            NA           NA       NA            NA        NA      NA
## D3Z5L6            NA           NA       NA            NA        NA      NA
## E9Q5C9 -1.798058e-09 6.822108e-05 29.11140 -2.635634e-05 0.9999792       1
##        Protein
## A2AJB7  A2AJB7
## A2AJK6  A2AJK6
## A2AQP0  A2AQP0
## A2AWP8  A2AWP8
## A6H8H2  A6H8H2
## B1AVY7  B1AVY7
## B2RSH2  B2RSH2
## C0HKD8  C0HKD8
## D3Z5L6  D3Z5L6
## E9Q5C9  E9Q5C9</code></pre>
<p>The table contains the hypothesis testing results for every protein.
Notice that several rows contain missing values. This is because data
modelling resulted in a <code>fitError</code>. The model cannot be estimated for
some proteins either because of patterns in missing values, for
instance a protein was not measured only in one of the groups of
interest, or because a protein was measured from a single peptide ion
alleviating the estimation of spectrum effects (see <a href="sec-advanced.html#sec-fiterror">how to deal with
<code>fitError</code>s</a>).</p>
<p>We can use the table above directly to build a volcano plot using
<code>ggplot2</code> functionality.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="sec-mouse_diet.html#cb342-1" tabindex="-1"></a><span class="fu">ggplot</span>(inference) <span class="sc">+</span></span>
<span id="cb342-2"><a href="sec-mouse_diet.html#cb342-2" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> logFC, <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(adjPval)) <span class="sc">+</span></span>
<span id="cb342-3"><a href="sec-mouse_diet.html#cb342-3" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fu">log10</span>(<span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb342-4"><a href="sec-mouse_diet.html#cb342-4" tabindex="-1"></a>    <span class="fu">geom_text_repel</span>(<span class="at">data =</span> <span class="fu">filter</span>(inference, adjPval <span class="sc">&lt;</span> <span class="fl">0.05</span>),</span>
<span id="cb342-5"><a href="sec-mouse_diet.html#cb342-5" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">label =</span> Protein)) <span class="sc">+</span></span>
<span id="cb342-6"><a href="sec-mouse_diet.html#cb342-6" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb342-7"><a href="sec-mouse_diet.html#cb342-7" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Statistical inference on differences between LF and HF (short duration)"</span>,</span>
<span id="cb342-8"><a href="sec-mouse_diet.html#cb342-8" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="st">"Hypothesis test:"</span>, <span class="fu">gsub</span>(<span class="st">"ridgeCondition"</span>, <span class="st">""</span>, <span class="fu">colnames</span>(L)), <span class="st">"= 0"</span>))</span></code></pre></div>
<div class="float">
<img src="figure/unnamed-chunk-36-1.png" alt="plot of chunk unnamed-chunk-36"><div class="figcaption">plot of chunk unnamed-chunk-36</div>
</div>
<p>In this example (remember this is a subset of the complete data set),
only a few proteins pass the significance threshold of 5%. Let us
visualise the protein with the largest fold change.</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="sec-mouse_diet.html#cb343-1" tabindex="-1"></a>(targetProtein <span class="ot">&lt;-</span> <span class="fu">rownames</span>(inference)[<span class="fu">which.max</span>(inference<span class="sc">$</span>logFC)])</span></code></pre></div>
<pre><code>## [1] "Q5SWU9"</code></pre>
<p>To obtain the required data, we perform a little data manipulation
pipeline:</p>
<ol style="list-style-type: decimal">
<li>We use the <code>QFeatures</code> subsetting functionality to retrieve all
data related to Q5SWU9 and focusing on the <code>ions_norm</code>
set that contains the preprocessed peptide ion data used for
modelling.</li>
<li>We use <code>longForm()</code> to convert the object into a table suitable
for plotting.</li>
<li>We remove missing values for plotting and focus only on the data
with short diet duration.</li>
<li>We reorder the sample identifiers to improve visualisation.</li>
</ol>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="sec-mouse_diet.html#cb345-1" tabindex="-1"></a>ionData <span class="ot">&lt;-</span> mouse[targetProtein, , <span class="st">"ions_norm"</span>] <span class="sc">|&gt;</span> <span class="co">#1</span></span>
<span id="cb345-2"><a href="sec-mouse_diet.html#cb345-2" tabindex="-1"></a>    <span class="fu">longForm</span>(<span class="at">colvars =</span> <span class="fu">colnames</span>(<span class="fu">colData</span>(mouse)), <span class="co">#2</span></span>
<span id="cb345-3"><a href="sec-mouse_diet.html#cb345-3" tabindex="-1"></a>               <span class="at">rowvars =</span> <span class="fu">c</span>(<span class="st">"Protein.Accessions"</span>, <span class="st">"ionID"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb345-4"><a href="sec-mouse_diet.html#cb345-4" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb345-5"><a href="sec-mouse_diet.html#cb345-5" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value) <span class="sc">&amp;</span> Duration <span class="sc">==</span> <span class="st">"Short"</span>) <span class="sc">|&gt;</span> <span class="co">#3</span></span>
<span id="cb345-6"><a href="sec-mouse_diet.html#cb345-6" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">colname =</span> <span class="fu">factor</span>(colname, <span class="at">levels =</span> <span class="fu">unique</span>(colname[<span class="fu">order</span>(Condition)]))) <span class="co">#4</span></span></code></pre></div>
<p>We can now plot the log normalised intensities. Since the protein is
modelled at the peptide ion level, multiple ion intensities are
recorded in each sample. Each ion is linked across samples using a
grey line. Samples are coloured according to the diet type. Finally,
we split the plot in facets, one for each mixture, to visualise the
heterogeneity induced by different pools of mice.</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="sec-mouse_diet.html#cb346-1" tabindex="-1"></a><span class="fu">ggplot</span>(ionData) <span class="sc">+</span></span>
<span id="cb346-2"><a href="sec-mouse_diet.html#cb346-2" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> colname,</span>
<span id="cb346-3"><a href="sec-mouse_diet.html#cb346-3" tabindex="-1"></a>        <span class="at">y =</span> value) <span class="sc">+</span></span>
<span id="cb346-4"><a href="sec-mouse_diet.html#cb346-4" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> ionID), <span class="at">linewidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb346-5"><a href="sec-mouse_diet.html#cb346-5" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> Condition)) <span class="sc">+</span></span>
<span id="cb346-6"><a href="sec-mouse_diet.html#cb346-6" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="sc">~</span> Mixture, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb346-7"><a href="sec-mouse_diet.html#cb346-7" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sample"</span>, <span class="at">y =</span> <span class="st">"log2 intensity"</span>) <span class="sc">+</span></span>
<span id="cb346-8"><a href="sec-mouse_diet.html#cb346-8" tabindex="-1"></a>    <span class="fu">ggtitle</span>(targetProtein) <span class="sc">+</span></span>
<span id="cb346-9"><a href="sec-mouse_diet.html#cb346-9" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb346-10"><a href="sec-mouse_diet.html#cb346-10" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<div class="float">
<img src="figure/unnamed-chunk-39-1.png" alt="plot of chunk unnamed-chunk-39"><div class="figcaption">plot of chunk unnamed-chunk-39</div>
</div>
<p>The statistical analysis revealed a significant increase (positive log
fold change) of the abundance for Q5SWU9 in the group fed
with a low-fat diet compared to the high-fat diet fed group (upon
early diet duration). This finding can be visually validated as there
is a systematic increase in peptide ion intensities between the
low-fat diet group (blue) compared to the high-fat diet group (red).</p>
</div>
<div id="difference-between-low-fat-and-high-fat-diet-after-long-duration" class="section level4" number="7.6.3.2">
<h4>
<span class="header-section-number">7.6.3.2</span> Difference between low fat and high fat diet after long duration</h4>
<p>The second question one can ask is what proteins are affected by diet
when only considering, this time, a long diet duration. Following the
same approach as above, the contrast becomes.</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="sec-mouse_diet.html#cb347-1" tabindex="-1"></a>hypothesis2 <span class="ot">&lt;-</span> <span class="st">"ridgeDietLF = 0"</span></span></code></pre></div>
<p>We run the same statistical analysis pipeline as above.</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="sec-mouse_diet.html#cb348-1" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">makeContrast</span>(</span>
<span id="cb348-2"><a href="sec-mouse_diet.html#cb348-2" tabindex="-1"></a>    hypothesis2,</span>
<span id="cb348-3"><a href="sec-mouse_diet.html#cb348-3" tabindex="-1"></a>    <span class="at">parameterNames =</span> <span class="fu">c</span>(<span class="st">"ridgeDietLF"</span>,<span class="st">"ridgeDurationShort"</span>,<span class="st">"ridgeDietLF:DurationShort"</span>)</span>
<span id="cb348-4"><a href="sec-mouse_diet.html#cb348-4" tabindex="-1"></a>)</span>
<span id="cb348-5"><a href="sec-mouse_diet.html#cb348-5" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">hypothesisTest</span>(</span>
<span id="cb348-6"><a href="sec-mouse_diet.html#cb348-6" tabindex="-1"></a>    mouse, <span class="at">i =</span> <span class="st">"proteins_msqrob"</span>, L, <span class="at">modelColumn =</span> <span class="st">"msqrob_ion"</span></span>
<span id="cb348-7"><a href="sec-mouse_diet.html#cb348-7" tabindex="-1"></a>)</span>
<span id="cb348-8"><a href="sec-mouse_diet.html#cb348-8" tabindex="-1"></a>inference <span class="ot">&lt;-</span> <span class="fu">rowData</span>(mouse[[<span class="st">"proteins_msqrob"</span>]])[[<span class="fu">colnames</span>(L)]]</span>
<span id="cb348-9"><a href="sec-mouse_diet.html#cb348-9" tabindex="-1"></a>inference<span class="sc">$</span>Protein <span class="ot">&lt;-</span> <span class="fu">rownames</span>(inference)</span></code></pre></div>
<p>And we plot the results.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="sec-mouse_diet.html#cb349-1" tabindex="-1"></a><span class="fu">ggplot</span>(inference) <span class="sc">+</span></span>
<span id="cb349-2"><a href="sec-mouse_diet.html#cb349-2" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> logFC, <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(adjPval)) <span class="sc">+</span></span>
<span id="cb349-3"><a href="sec-mouse_diet.html#cb349-3" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fu">log10</span>(<span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb349-4"><a href="sec-mouse_diet.html#cb349-4" tabindex="-1"></a>    <span class="fu">geom_text_repel</span>(<span class="at">data =</span> <span class="fu">filter</span>(inference, adjPval <span class="sc">&lt;</span> <span class="fl">0.05</span>),</span>
<span id="cb349-5"><a href="sec-mouse_diet.html#cb349-5" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">label =</span> Protein)) <span class="sc">+</span></span>
<span id="cb349-6"><a href="sec-mouse_diet.html#cb349-6" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb349-7"><a href="sec-mouse_diet.html#cb349-7" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Statistical inference on differences between LF and HF (long duration)"</span>,</span>
<span id="cb349-8"><a href="sec-mouse_diet.html#cb349-8" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="st">"Hypothesis test:"</span>, <span class="fu">gsub</span>(<span class="st">"ridgeCondition"</span>, <span class="st">""</span>, <span class="fu">colnames</span>(L)), <span class="st">"= 0"</span>))</span></code></pre></div>
<div class="float">
<img src="figure/unnamed-chunk-42-1.png" alt="plot of chunk unnamed-chunk-42"><div class="figcaption">plot of chunk unnamed-chunk-42</div>
</div>
<p>Again, only a few proteins come out differentially abundant between
the two diets, but after a long diet duration. Surprisingly, there
is only a small overlap between differential protein after short
duration and after long duration. One hypothesis is that there is not
sufficient data to detect a reliable difference. A solution would be
to combine both short and long diet duration to retrieve an averaged
systematic effect between diets that combine all available data.
Another hypothesis is that diet duration may influence the effect of
diet on the protein abundances. We will explore the two hypothesis in
the following two sub-sections.</p>
</div>
<div id="average-difference-between-low-fat-and-high-fat-diet" class="section level4" number="7.6.3.3">
<h4>
<span class="header-section-number">7.6.3.3</span> Average difference between low fat and high fat diet</h4>
<p>One may want to identify the set of proteins that are systematically
differentially abundant between diets, irrespective of the duration.
To answer this question, we want to infer on the average difference
between group <code>LF</code> and group <code>HF</code>. The average low-fat diet is defined
by <code>((Intercept) + DietLF + DurationShort + DietLF:DurationShort + (Intercept) + DietLF)/2</code>. The average high-fat diet group is defined
by <code>((Intercept) + DurationShort + (Intercept))/2</code>. The difference
between the two results in the hypothesis below:</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="sec-mouse_diet.html#cb350-1" tabindex="-1"></a>hypothesis3 <span class="ot">&lt;-</span> <span class="st">"ridgeDietLF + (ridgeDietLF:DurationShort)/2 = 0"</span></span></code></pre></div>
<p>We next run again the same statistical analysis pipeline as above.</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="sec-mouse_diet.html#cb351-1" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">makeContrast</span>(</span>
<span id="cb351-2"><a href="sec-mouse_diet.html#cb351-2" tabindex="-1"></a>    hypothesis3,</span>
<span id="cb351-3"><a href="sec-mouse_diet.html#cb351-3" tabindex="-1"></a>    <span class="at">parameterNames =</span> <span class="fu">c</span>(<span class="st">"ridgeDietLF"</span>,<span class="st">"ridgeDurationShort"</span>,<span class="st">"ridgeDietLF:DurationShort"</span>)</span>
<span id="cb351-4"><a href="sec-mouse_diet.html#cb351-4" tabindex="-1"></a>)</span>
<span id="cb351-5"><a href="sec-mouse_diet.html#cb351-5" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">hypothesisTest</span>(</span>
<span id="cb351-6"><a href="sec-mouse_diet.html#cb351-6" tabindex="-1"></a>    mouse, <span class="at">i =</span> <span class="st">"proteins_msqrob"</span>, L, <span class="at">modelColumn =</span> <span class="st">"msqrob_ion"</span></span>
<span id="cb351-7"><a href="sec-mouse_diet.html#cb351-7" tabindex="-1"></a>)</span>
<span id="cb351-8"><a href="sec-mouse_diet.html#cb351-8" tabindex="-1"></a>inference <span class="ot">&lt;-</span> <span class="fu">rowData</span>(mouse[[<span class="st">"proteins_msqrob"</span>]])[[<span class="fu">colnames</span>(L)]]</span>
<span id="cb351-9"><a href="sec-mouse_diet.html#cb351-9" tabindex="-1"></a>inference<span class="sc">$</span>Protein <span class="ot">&lt;-</span> <span class="fu">rownames</span>(inference)</span></code></pre></div>
<p>And we plot the results.</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="sec-mouse_diet.html#cb352-1" tabindex="-1"></a><span class="fu">ggplot</span>(inference) <span class="sc">+</span></span>
<span id="cb352-2"><a href="sec-mouse_diet.html#cb352-2" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> logFC, <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(adjPval)) <span class="sc">+</span></span>
<span id="cb352-3"><a href="sec-mouse_diet.html#cb352-3" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fu">log10</span>(<span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb352-4"><a href="sec-mouse_diet.html#cb352-4" tabindex="-1"></a>    <span class="fu">geom_text_repel</span>(<span class="at">data =</span> <span class="fu">filter</span>(inference, adjPval <span class="sc">&lt;</span> <span class="fl">0.05</span>),</span>
<span id="cb352-5"><a href="sec-mouse_diet.html#cb352-5" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">label =</span> Protein)) <span class="sc">+</span></span>
<span id="cb352-6"><a href="sec-mouse_diet.html#cb352-6" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb352-7"><a href="sec-mouse_diet.html#cb352-7" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Statistical inference on average difference between LF and HF"</span>,</span>
<span id="cb352-8"><a href="sec-mouse_diet.html#cb352-8" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="st">"Hypothesis test:"</span>, <span class="fu">gsub</span>(<span class="st">"ridgeCondition"</span>, <span class="st">""</span>, <span class="fu">colnames</span>(L)), <span class="st">"= 0"</span>))</span></code></pre></div>
<div class="float">
<img src="figure/unnamed-chunk-45-1.png" alt="plot of chunk unnamed-chunk-45"><div class="figcaption">plot of chunk unnamed-chunk-45</div>
</div>
<p>We find much more significant proteins when combining all available
data to infer the differences between low-fat and high-fat diets,
irrespective of duration. We also retrieve a good overlap between this
set of significant proteins and the two previous sets, indicating
that more data helped improving the statistical power.</p>
</div>
<div id="interaction-does-the-diet-effect-change-according-to-duration" class="section level4" number="7.6.3.4">
<h4>
<span class="header-section-number">7.6.3.4</span> Interaction: does the diet effect change according to duration?</h4>
<p>We will now explore whether the effect of diet on protein abundance
may be affected by duration, i.e. we want to infer on the difference
of differences. The difference between hypothesis 1 and 2 is <code>(DietLF + DietLF:DurationShort) - (DietLF)</code> and results in the hypothesis
below:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="sec-mouse_diet.html#cb353-1" tabindex="-1"></a>hypothesis4 <span class="ot">&lt;-</span> <span class="st">"ridgeDietLF:DurationShort = 0"</span></span></code></pre></div>
<p>We can proceed with the same statistical pipeline.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="sec-mouse_diet.html#cb354-1" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">makeContrast</span>(</span>
<span id="cb354-2"><a href="sec-mouse_diet.html#cb354-2" tabindex="-1"></a>    hypothesis4,</span>
<span id="cb354-3"><a href="sec-mouse_diet.html#cb354-3" tabindex="-1"></a>    <span class="at">parameterNames =</span> <span class="fu">c</span>(<span class="st">"ridgeDietLF"</span>,<span class="st">"ridgeDurationShort"</span>,<span class="st">"ridgeDietLF:DurationShort"</span>)</span>
<span id="cb354-4"><a href="sec-mouse_diet.html#cb354-4" tabindex="-1"></a>)</span>
<span id="cb354-5"><a href="sec-mouse_diet.html#cb354-5" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">hypothesisTest</span>(</span>
<span id="cb354-6"><a href="sec-mouse_diet.html#cb354-6" tabindex="-1"></a>    mouse, <span class="at">i =</span> <span class="st">"proteins_msqrob"</span>, L, <span class="at">modelColumn =</span> <span class="st">"msqrob_ion"</span></span>
<span id="cb354-7"><a href="sec-mouse_diet.html#cb354-7" tabindex="-1"></a>)</span>
<span id="cb354-8"><a href="sec-mouse_diet.html#cb354-8" tabindex="-1"></a>inference <span class="ot">&lt;-</span> <span class="fu">rowData</span>(mouse[[<span class="st">"proteins_msqrob"</span>]])[[<span class="fu">colnames</span>(L)]]</span>
<span id="cb354-9"><a href="sec-mouse_diet.html#cb354-9" tabindex="-1"></a>inference<span class="sc">$</span>Protein <span class="ot">&lt;-</span> <span class="fu">rownames</span>(inference)</span></code></pre></div>
<p>And we plot the results.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="sec-mouse_diet.html#cb355-1" tabindex="-1"></a><span class="fu">ggplot</span>(inference) <span class="sc">+</span></span>
<span id="cb355-2"><a href="sec-mouse_diet.html#cb355-2" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> logFC, <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(adjPval)) <span class="sc">+</span></span>
<span id="cb355-3"><a href="sec-mouse_diet.html#cb355-3" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fu">log10</span>(<span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb355-4"><a href="sec-mouse_diet.html#cb355-4" tabindex="-1"></a>    <span class="fu">geom_text_repel</span>(<span class="at">data =</span> <span class="fu">filter</span>(inference, adjPval <span class="sc">&lt;</span> <span class="fl">0.05</span>),</span>
<span id="cb355-5"><a href="sec-mouse_diet.html#cb355-5" tabindex="-1"></a>                    <span class="fu">aes</span>(<span class="at">label =</span> Protein)) <span class="sc">+</span></span>
<span id="cb355-6"><a href="sec-mouse_diet.html#cb355-6" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb355-7"><a href="sec-mouse_diet.html#cb355-7" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Statistical inference on the effect of duration on the differences between diets"</span>,</span>
<span id="cb355-8"><a href="sec-mouse_diet.html#cb355-8" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="st">"Hypothesis test:"</span>, <span class="fu">gsub</span>(<span class="st">"ridgeCondition"</span>, <span class="st">""</span>, <span class="fu">colnames</span>(L)), <span class="st">"= 0"</span>))</span></code></pre></div>
<div class="float">
<img src="figure/unnamed-chunk-48-1.png" alt="plot of chunk unnamed-chunk-48"><div class="figcaption">plot of chunk unnamed-chunk-48</div>
</div>
<p>There is only one protein for which duration impacts the effect of
diet. Let us visually explore this changes for the most significant
protein.</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="sec-mouse_diet.html#cb356-1" tabindex="-1"></a>(targetProtein <span class="ot">&lt;-</span> <span class="fu">rownames</span>(inference)[<span class="fu">which.min</span>(inference<span class="sc">$</span>adjPval)])</span></code></pre></div>
<pre><code>## [1] "Q924P3"</code></pre>
<p>We use again <code>Qfeatures</code>’s data manipulation pipeline.</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="sec-mouse_diet.html#cb358-1" tabindex="-1"></a>ionData <span class="ot">&lt;-</span> mouse[targetProtein, , <span class="st">"ions_norm"</span>] <span class="sc">|&gt;</span> <span class="co">#1</span></span>
<span id="cb358-2"><a href="sec-mouse_diet.html#cb358-2" tabindex="-1"></a>    <span class="fu">longForm</span>(<span class="at">colvars =</span> <span class="fu">colnames</span>(<span class="fu">colData</span>(mouse)), <span class="co">#2</span></span>
<span id="cb358-3"><a href="sec-mouse_diet.html#cb358-3" tabindex="-1"></a>               <span class="at">rowvars =</span> <span class="fu">c</span>(<span class="st">"Protein.Accessions"</span>, <span class="st">"ionID"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb358-4"><a href="sec-mouse_diet.html#cb358-4" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb358-5"><a href="sec-mouse_diet.html#cb358-5" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)) <span class="sc">|&gt;</span> <span class="co">#3</span></span>
<span id="cb358-6"><a href="sec-mouse_diet.html#cb358-6" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">colname =</span> <span class="fu">factor</span>(colname, <span class="at">levels =</span> <span class="fu">unique</span>(colname[<span class="fu">order</span>(Condition)]))) <span class="co">#4</span></span></code></pre></div>
<p>And we explore the peptide ion data by visualising the differences
between LF and HF separately for each mixture and diet duration in
order to highlight changes in direction between these differences
according to duration. We link data points belonging to the same
peptide ion using a grey line.</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="sec-mouse_diet.html#cb359-1" tabindex="-1"></a><span class="fu">ggplot</span>(ionData) <span class="sc">+</span></span>
<span id="cb359-2"><a href="sec-mouse_diet.html#cb359-2" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> colname,</span>
<span id="cb359-3"><a href="sec-mouse_diet.html#cb359-3" tabindex="-1"></a>        <span class="at">y =</span> value) <span class="sc">+</span></span>
<span id="cb359-4"><a href="sec-mouse_diet.html#cb359-4" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> ionID), <span class="at">linewidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb359-5"><a href="sec-mouse_diet.html#cb359-5" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> Diet)) <span class="sc">+</span></span>
<span id="cb359-6"><a href="sec-mouse_diet.html#cb359-6" tabindex="-1"></a>    <span class="fu">facet_grid</span>(Mixture <span class="sc">~</span> Duration, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb359-7"><a href="sec-mouse_diet.html#cb359-7" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sample"</span>, <span class="at">y =</span> <span class="st">"log2 intensity"</span>) <span class="sc">+</span></span>
<span id="cb359-8"><a href="sec-mouse_diet.html#cb359-8" tabindex="-1"></a>    <span class="fu">ggtitle</span>(targetProtein) <span class="sc">+</span></span>
<span id="cb359-9"><a href="sec-mouse_diet.html#cb359-9" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb359-10"><a href="sec-mouse_diet.html#cb359-10" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<div class="float">
<img src="figure/unnamed-chunk-51-1.png" alt="plot of chunk unnamed-chunk-51"><div class="figcaption">plot of chunk unnamed-chunk-51</div>
</div>
<p>The graph hints towards a slight increase in protein abundance in the
low-fat diet group compared to the high-fat diet group during a short
diet duration, but this increase disappears after a long diet
duration. However, the visual inspection of the results also shows
that the result rely on sparse and highly unbalanced data. The results
may hence require further experimental validation.</p>
<p>Note that we performed the statistical analysis for each hypothesis
separately. However, <code>msqrob2</code> can assess multiple hypothesis at once.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="sec-mouse_diet.html#cb360-1" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">makeContrast</span>(</span>
<span id="cb360-2"><a href="sec-mouse_diet.html#cb360-2" tabindex="-1"></a>    <span class="fu">c</span>(hypothesis1, hypothesis2, hypothesis3, hypothesis4),</span>
<span id="cb360-3"><a href="sec-mouse_diet.html#cb360-3" tabindex="-1"></a>    <span class="at">parameterNames =</span> <span class="fu">c</span>(<span class="st">"ridgeDietLF"</span>,<span class="st">"ridgeDurationShort"</span>,<span class="st">"ridgeDietLF:DurationShort"</span>)</span>
<span id="cb360-4"><a href="sec-mouse_diet.html#cb360-4" tabindex="-1"></a>)</span>
<span id="cb360-5"><a href="sec-mouse_diet.html#cb360-5" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">hypothesisTest</span>(</span>
<span id="cb360-6"><a href="sec-mouse_diet.html#cb360-6" tabindex="-1"></a>    mouse, <span class="at">i =</span> <span class="st">"proteins_msqrob"</span>, L,</span>
<span id="cb360-7"><a href="sec-mouse_diet.html#cb360-7" tabindex="-1"></a>    <span class="at">modelColumn =</span> <span class="st">"msqrob_ion"</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb360-8"><a href="sec-mouse_diet.html#cb360-8" tabindex="-1"></a>)</span></code></pre></div>
<p>Note that since we already generated results for the contrast, we
overwrite the results with the argument <code>overwrite = TRUE</code>.</p>
<p>We retrieve the inference tables from the <code>rowData</code> to generate the
volcano plot.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="sec-mouse_diet.html#cb361-1" tabindex="-1"></a>inferenceTables <span class="ot">&lt;-</span> <span class="fu">rowData</span>(mouse[[<span class="st">"proteins_msqrob"</span>]])[, <span class="fu">colnames</span>(L)]</span></code></pre></div>
<p>We here use a <code>lapply()</code> loop to generate the plots. The code chunk is
elaborate, but follows the same structure as in the previous section.
This generates a list of volcano plots, one for each hypothesis.</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="sec-mouse_diet.html#cb362-1" tabindex="-1"></a>volcanoPlots <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">colnames</span>(inferenceTables), <span class="cf">function</span>(i) {</span>
<span id="cb362-2"><a href="sec-mouse_diet.html#cb362-2" tabindex="-1"></a>    inference <span class="ot">&lt;-</span> inferenceTables[[i]]</span>
<span id="cb362-3"><a href="sec-mouse_diet.html#cb362-3" tabindex="-1"></a>    inference<span class="sc">$</span>Protein <span class="ot">&lt;-</span> <span class="fu">rownames</span>(inference)</span>
<span id="cb362-4"><a href="sec-mouse_diet.html#cb362-4" tabindex="-1"></a>    <span class="fu">ggplot</span>(inference) <span class="sc">+</span></span>
<span id="cb362-5"><a href="sec-mouse_diet.html#cb362-5" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">x =</span> logFC, <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(adjPval)) <span class="sc">+</span></span>
<span id="cb362-6"><a href="sec-mouse_diet.html#cb362-6" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fu">log10</span>(<span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb362-7"><a href="sec-mouse_diet.html#cb362-7" tabindex="-1"></a>        <span class="fu">geom_text_repel</span>(<span class="at">data =</span> <span class="fu">filter</span>(inference, adjPval <span class="sc">&lt;</span> <span class="fl">0.05</span>),</span>
<span id="cb362-8"><a href="sec-mouse_diet.html#cb362-8" tabindex="-1"></a>                        <span class="fu">aes</span>(<span class="at">label =</span> Protein)) <span class="sc">+</span></span>
<span id="cb362-9"><a href="sec-mouse_diet.html#cb362-9" tabindex="-1"></a>        <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb362-10"><a href="sec-mouse_diet.html#cb362-10" tabindex="-1"></a>        <span class="fu">ggtitle</span>(<span class="st">"Hypothesis test:"</span>,</span>
<span id="cb362-11"><a href="sec-mouse_diet.html#cb362-11" tabindex="-1"></a>                <span class="fu">paste</span>(<span class="fu">gsub</span>(<span class="st">"ridge"</span>, <span class="st">""</span>, i), <span class="st">"= 0"</span>))</span>
<span id="cb362-12"><a href="sec-mouse_diet.html#cb362-12" tabindex="-1"></a>})</span></code></pre></div>
<p>We combine all the plots in a single figure using the <code>patchwork</code>
packages.</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="sec-mouse_diet.html#cb363-1" tabindex="-1"></a><span class="fu">wrap_plots</span>(volcanoPlots)</span></code></pre></div>
<div class="float">
<img src="figure/unnamed-chunk-55-1.png" alt="plot of chunk unnamed-chunk-55"><div class="figcaption">plot of chunk unnamed-chunk-55</div>
</div>
</div>
</div>
<div id="protein-level-model" class="section level3" number="7.6.4">
<h3>
<span class="header-section-number">7.6.4</span> Protein-level model<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('protein-level-model')" onmouseout="reset_tooltip('protein-level-model-tooltip')"><span class="tooltiptext" id="protein-level-model-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>This section illustrates data modelling starting from protein data
instead of ion data.</p>
<p>Here, the workflow will use the summarised peptide ion intensities, as
performed during the preprocessing. Note, that we no longer have
multiple quantitative values for a protein in the same label of a run.
Hence, we can omit the nested effects for label and ionID in run.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="sec-mouse_diet.html#cb364-1" tabindex="-1"></a>modelSum <span class="ot">&lt;-</span> <span class="er">~</span> Diet <span class="sc">*</span> Duration <span class="sc">+</span> <span class="do">## fixed effect for Diet and Duration with interaction</span></span>
<span id="cb364-2"><a href="sec-mouse_diet.html#cb364-2" tabindex="-1"></a>        (<span class="dv">1</span> <span class="sc">|</span> Label) <span class="sc">+</span> <span class="do">## (1) random effect for label</span></span>
<span id="cb364-3"><a href="sec-mouse_diet.html#cb364-3" tabindex="-1"></a>        (<span class="dv">1</span> <span class="sc">|</span> Mixture) <span class="sc">+</span> <span class="do">## (2) random effect for mixture</span></span>
<span id="cb364-4"><a href="sec-mouse_diet.html#cb364-4" tabindex="-1"></a>        (<span class="dv">1</span> <span class="sc">|</span> Run) <span class="sc">+</span> <span class="do">## (3) random effect for MS run</span></span>
<span id="cb364-5"><a href="sec-mouse_diet.html#cb364-5" tabindex="-1"></a>        (<span class="dv">1</span> <span class="sc">|</span> BioReplicate)  <span class="do">## (6) random effect for biorepeat (mouse)</span></span></code></pre></div>
<p>For protein-level modelling, we use <code>msqrob()</code> instead of
<code>msqrobAggregate()</code>, but their function arguments closely overlap.</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="sec-mouse_diet.html#cb365-1" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">msqrob</span>(</span>
<span id="cb365-2"><a href="sec-mouse_diet.html#cb365-2" tabindex="-1"></a>    mouse, <span class="at">i =</span> <span class="st">"proteins"</span>,</span>
<span id="cb365-3"><a href="sec-mouse_diet.html#cb365-3" tabindex="-1"></a>    <span class="at">formula =</span> modelSum,</span>
<span id="cb365-4"><a href="sec-mouse_diet.html#cb365-4" tabindex="-1"></a>    <span class="at">modelColumnName =</span> <span class="st">"msqrob_rrilmm"</span>,</span>
<span id="cb365-5"><a href="sec-mouse_diet.html#cb365-5" tabindex="-1"></a>    <span class="at">ridge =</span> <span class="cn">TRUE</span>, <span class="at">robust =</span> <span class="cn">TRUE</span></span>
<span id="cb365-6"><a href="sec-mouse_diet.html#cb365-6" tabindex="-1"></a>)</span></code></pre></div>
<p>We perform hypothesis tests for the early, late, average and
interaction effects. Note that the contrasts remain unchanged.</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="sec-mouse_diet.html#cb366-1" tabindex="-1"></a>mouse <span class="ot">&lt;-</span> <span class="fu">hypothesisTest</span>(</span>
<span id="cb366-2"><a href="sec-mouse_diet.html#cb366-2" tabindex="-1"></a>    mouse, <span class="at">i =</span> <span class="st">"proteins"</span>, L, <span class="at">modelColumn =</span> <span class="st">"msqrob_rrilmm"</span></span>
<span id="cb366-3"><a href="sec-mouse_diet.html#cb366-3" tabindex="-1"></a>)</span></code></pre></div>
<p>The inference tables were all stored in the <code>rowData</code> as separate
columns, like previously.</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="sec-mouse_diet.html#cb367-1" tabindex="-1"></a>inferenceTablesSum <span class="ot">&lt;-</span> <span class="fu">rowData</span>(mouse[[<span class="st">"proteins"</span>]])[, <span class="fu">colnames</span>(L)]</span></code></pre></div>
<p>We here use again the <code>lapply()</code> loop that generates the list of
volcano plots, one for each hypothesis.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="sec-mouse_diet.html#cb368-1" tabindex="-1"></a>volcanoPlotsSum <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(inferenceTablesSum), <span class="cf">function</span>(i) {</span>
<span id="cb368-2"><a href="sec-mouse_diet.html#cb368-2" tabindex="-1"></a>    inference <span class="ot">&lt;-</span> inferenceTablesSum[[i]]</span>
<span id="cb368-3"><a href="sec-mouse_diet.html#cb368-3" tabindex="-1"></a>    inference<span class="sc">$</span>Protein <span class="ot">&lt;-</span> <span class="fu">rownames</span>(inference)</span>
<span id="cb368-4"><a href="sec-mouse_diet.html#cb368-4" tabindex="-1"></a>    <span class="fu">ggplot</span>(inference) <span class="sc">+</span></span>
<span id="cb368-5"><a href="sec-mouse_diet.html#cb368-5" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">x =</span> logFC, <span class="at">y =</span> <span class="sc">-</span><span class="fu">log10</span>(adjPval)) <span class="sc">+</span></span>
<span id="cb368-6"><a href="sec-mouse_diet.html#cb368-6" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fu">log10</span>(<span class="fl">0.05</span>)) <span class="sc">+</span></span>
<span id="cb368-7"><a href="sec-mouse_diet.html#cb368-7" tabindex="-1"></a>        <span class="fu">geom_text_repel</span>(<span class="at">data =</span> <span class="fu">filter</span>(inference, adjPval <span class="sc">&lt;</span> <span class="fl">0.05</span>),</span>
<span id="cb368-8"><a href="sec-mouse_diet.html#cb368-8" tabindex="-1"></a>                        <span class="fu">aes</span>(<span class="at">label =</span> Protein)) <span class="sc">+</span></span>
<span id="cb368-9"><a href="sec-mouse_diet.html#cb368-9" tabindex="-1"></a>        <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb368-10"><a href="sec-mouse_diet.html#cb368-10" tabindex="-1"></a>        <span class="fu">ggtitle</span>(<span class="st">"Hypothesis test:"</span>,</span>
<span id="cb368-11"><a href="sec-mouse_diet.html#cb368-11" tabindex="-1"></a>                <span class="fu">paste</span>(<span class="fu">gsub</span>(<span class="st">"tests_|ridge"</span>, <span class="st">""</span>, i), <span class="st">"= 0"</span>))</span>
<span id="cb368-12"><a href="sec-mouse_diet.html#cb368-12" tabindex="-1"></a>})</span></code></pre></div>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="sec-mouse_diet.html#cb369-1" tabindex="-1"></a><span class="fu">wrap_plots</span>(volcanoPlotsSum)</span></code></pre></div>
<div class="float">
<img src="figure/unnamed-chunk-61-1.png" alt="plot of chunk unnamed-chunk-61"><div class="figcaption">plot of chunk unnamed-chunk-61</div>
</div>
</div>
</div>
<div id="conclusion-4" class="section level2" number="7.7">
<h2>
<span class="header-section-number">7.7</span> Conclusion<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('conclusion-4')" onmouseout="reset_tooltip('conclusion-4-tooltip')"><span class="tooltiptext" id="conclusion-4-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>In this chapter, we have demonstrated the application of msqrob2TMT
workflows on a real-life case study.</p>
<p>The preprocessing workflow relies on the the <code>QFeatures</code> package. The
package provides functionality to carry out many steps like data
filtering, missing values management, normalisation,
log-transformation, imputation, summarisation, etc. The functions also
provide different methods for each step, meaning that the
preprocessing pipeline can be easily adapted to the researcher’s
needs based on their experiment and data set.</p>
<p>Once preprocessed, we used the <code>msqrob2</code> package to model all sources
of variability as identified from the experimental design (and in part
validated by data exploration): effect of diet and duration, effect of
the MS acquisition run, effect of TMT mixture, effect of spectrum, and
effect of sample. Modelling these different sources of variability
allows to correctly infer changes in protein abundances between groups
of interest while using ion-level data, although we also illustrate
how to model the data at the protein level.</p>
<p>The experiment aims to understand the proteomic changes in mouse
adipose tissue that occur upon feeding the mice with low-fat or
high-fat diets, during a short or a long duration. We showed how to
model these data as two factor and how to translate biological
questions to statistical hypothesis and contrast matrices using our
msqrob2TMT workflow. To allow for the diet duration to influence the
impact of diet type, we included an interaction term. The unique
feature of <code>msqrob2</code> is that its flexible approach can include more
than 2 variables (with multiple interaction terms) as well as
including numerical variables, which may be essential in other
experimental contexts.</p>
<p>Modelling TMT-based data with biological replication leads to one of
the most complex designs. These have to be further complexified with
upcoming single-cell proteomics design where a new source of
variability arises as cells belonging to the same experimental unit
(subject or cell culture) are more similar than cells belonging to
different experimental units. However, the model simplifies for other
use cases. For instance, we saw how a protein-level model upon
aggregation simplifies the model. However, spectrum effects can no
longer be accounted for. This means that an appropriate summarisation
approach is needed to correctly account for these spectrum effects
when computing the summaries. Median polish (exemplified here) or
robust summary do account for this, at least partially depending on
the experimental design. Label-free experiments, which do not perform
chemical labelling of the samples, do not contain labelling effects
which therefore are omitted. Moreover, every sample is acquired as
part of a single run hence no run effect can be modelled. This
simplified model is easier to understand but bear in mind that the
unmodelled effects (eg. spectrum effects or run effect) may end up
increasing the residual variance, hence reduce statistical power.</p>
<p>Hence, we here demonstrated the power and flexibility of <code>msqrob2</code> and
the msqrob2TMT workflows to help researchers answer
biologically-relevant questions from their MS proteomics data.</p>

</div>
</div>
<p style="text-align: center;">
<a href="sec-heart.html"><button class="btn btn-default">Previous</button></a>
<a href="sec-end.html"><button class="btn btn-default">Next</button></a>
</p>
<p class="build-date">Page built: 
2025-11-12
 using 
R version 4.5.2 (2025-10-31)
</p>
</div>
</div>



</body>
</html>
