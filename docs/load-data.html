<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Chapter 4 Load data | Statistical analysis for proteomics data" />
<meta property="og:type" content="book" />




<meta name="author" content="Christophe Vanderaa, Stijn Vandenbulcke, Lieven Clement" />

<meta name="date" content="2025-09-03" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="Chapter 4 Load data | Statistical analysis for proteomics data">

<title>Chapter 4 Load data | Statistical analysis for proteomics data</title>

<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/envisioned.css" rel="stylesheet" />
<link href="libs/msmb-css-0/msmb.css" rel="stylesheet" />
<script>
function toggle_visibility(id1, id2) {
var e = document.getElementById(id1);
var f = document.getElementById(id2);

e.style.display = ((e.style.display!='none') ? 'none' : 'block');

if(f.classList.contains('fa-plus-square')) {
    f.classList.add('fa-minus-square')
    f.classList.remove('fa-plus-square')
} else {
    f.classList.add('fa-plus-square')
    f.classList.remove('fa-minus-square')
}

}
</script>
<script>
function copy_link(id) {
  var dummy = document.createElement('input'),
  text = window.location.href.split(/[?#]/)[0] + '#' + id;
  document.body.appendChild(dummy);
  dummy.value = text;
  dummy.select();
  document.execCommand('copy');
  document.body.removeChild(dummy);
  
  var tooltip = document.getElementById(id + '-tooltip');
  tooltip.innerHTML = 'Copied!';
}

function reset_tooltip(id) {
  var tooltip = document.getElementById(id);
  tooltip.innerHTML = 'Copy link';
}
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }

code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul class="navbar">
<li class="msmb"><p class="title">Statistical analysis for proteomics data<p><p class="author">Christophe Vanderaa, Stijn Vandenbulcke, Lieven Clement</p>
<li class="dropdown" style="float:right">
<a href="javascript:void(0)" class="dropbtn">&#x25BE; Chapters</a>
<div class="dropdown-content">
<a href="index.html" id="toc-preamble"><span class="toc-section-number">1</span> Preamble</a>
<a href="statistical-analysis-with-msqrob2.html" id="toc-statistical-analysis-with-msqrob2"><span class="toc-section-number">2</span> Statistical analysis with msqrob2</a>
<a href="load-packages.html" id="toc-load-packages"><span class="toc-section-number">3</span> Load packages</a>
<a id="active-page" href="load-data.html" id="toc-load-data"><span class="toc-section-number">4</span> Load data</a>
<a href="data-preprocessing.html" id="toc-data-preprocessing"><span class="toc-section-number">5</span> Data preprocessing</a>
<a href="modelling-sources-of-variation.html" id="toc-modelling-sources-of-variation"><span class="toc-section-number">6</span> Modelling sources of variation</a>
<a href="statistical-inference.html" id="toc-statistical-inference"><span class="toc-section-number">7</span> Statistical inference</a>
<a href="dealing-with-fiterrors.html" id="toc-dealing-with-fiterrors"><span class="toc-section-number">8</span> Dealing with <code>fitErrors</code></a>
<a href="conclusion.html" id="toc-conclusion"><span class="toc-section-number">9</span> Conclusion</a>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="load-data" class="section level1" number="4">
<h1>
<span class="header-section-number">Chapter 4</span> Load data</h1>
<p>The data set used in this vignette is a spike-in experiment, published
in <a href="http://dx.doi.org/10.1074/mcp.RA120.002105">Huang et al.Â 2020</a>
(PXD0015258). It consists of controlled mixtures with known ground
truth. UPS1 peptides at concentrations of 500, 333, 250, and 62.5 fmol
were spiked into 50 g of SILAC HeLa peptides, each in duplicate. These
concentrations form a dilution series of 1, 0.667, 0.5, and 0.125
relative to the highest UPS1 peptide amount (500 fmol). A reference
sample was created by combining the diluted UPS1 peptide samples with
50g of SILAC HeLa peptides. All dilutions and the reference sample
were prepared in duplicate, resulting in a total of ten samples. These
samples were then treated with TMT10-plex reagents and combined before
LC-MS/MS analysis. This protocol was repeated five times, each with
three technical replicates, totaling 15 MS runs.</p>
<p>The data have been deposited by the authors in the <code>MSV000084264</code>
MASSiVE repository, but we will retrieve the timestamped data from our
<a href="https://zenodo.org/records/14767905">Zenodo repository</a>. To
facilitate management of the files, we here
download them using the <code>BiocFileCache</code> package. We need 2 files: the
Skyline identification and quantification table generated by the
authors and the sample annotation files. <code>BiocFileCache</code> ensures that
the files are downloaded once, hence the chunk below will take some
time only the first time you run it.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="load-data.html#cb5-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"BiocFileCache"</span>)</span>
<span id="cb5-2"><a href="load-data.html#cb5-2" tabindex="-1"></a>bfc <span class="ot">&lt;-</span> <span class="fu">BiocFileCache</span>()</span>
<span id="cb5-3"><a href="load-data.html#cb5-3" tabindex="-1"></a>psmFile <span class="ot">&lt;-</span> <span class="fu">bfcrpath</span>(bfc, <span class="st">"https://zenodo.org/records/14767905/files/spikein1_psms.txt?download=1"</span>)</span>
<span id="cb5-4"><a href="load-data.html#cb5-4" tabindex="-1"></a>annotFile <span class="ot">&lt;-</span> <span class="fu">bfcrpath</span>(bfc, <span class="st">"https://zenodo.org/records/14767905/files/spikein1_annotations.csv?download=1"</span>)</span></code></pre></div>
<p>Now the files are downloaded, we can load the two tables. We also
perform a little cleanup of the sample annotations to generate the
information needed for downstream data processing.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="load-data.html#cb6-1" tabindex="-1"></a>psms <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(psmFile)</span>
<span id="cb6-2"><a href="load-data.html#cb6-2" tabindex="-1"></a>coldata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(annotFile)</span>
<span id="cb6-3"><a href="load-data.html#cb6-3" tabindex="-1"></a>coldata <span class="ot">&lt;-</span> coldata[, <span class="fu">c</span>(<span class="st">"Run"</span>, <span class="st">"Channel"</span>, <span class="st">"Condition"</span>, <span class="st">"Mixture"</span>, <span class="st">"TechRepMixture"</span>)]</span>
<span id="cb6-4"><a href="load-data.html#cb6-4" tabindex="-1"></a>coldata<span class="sc">$</span>FileName <span class="ot">&lt;-</span> coldata<span class="sc">$</span>Run</span>
<span id="cb6-5"><a href="load-data.html#cb6-5" tabindex="-1"></a>coldata<span class="sc">$</span>Run <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^.*(Mix.*).raw"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, coldata<span class="sc">$</span>Run)</span></code></pre></div>
<p>There is a peculiarity with the dataset: the spectra have been
identified with 2 nodes. In one node, the authors searched the
SwissProt database for proteins with static modifications related to
the metabolic labelling, in the other node they searched the Sigma_UPS
protein database without these static modifications. However, some
spectra were identified by both nodes leading to duplicate PSMs. We
here remove these duplicated PSMs that are identification artefacts.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="load-data.html#cb7-1" tabindex="-1"></a>qcols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"Abundance"</span>, <span class="fu">colnames</span>(psms), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-2"><a href="load-data.html#cb7-2" tabindex="-1"></a>duplicatesQuants <span class="ot">&lt;-</span> <span class="fu">duplicated</span>(psms[, qcols]) <span class="sc">|</span> <span class="fu">duplicated</span>(psms[, qcols], <span class="at">fromLast =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-3"><a href="load-data.html#cb7-3" tabindex="-1"></a>psms <span class="ot">&lt;-</span> psms[<span class="sc">!</span>duplicatesQuants, ]</span></code></pre></div>
<p>We will also subset the data set to reduce computational costs. If you
want to run the vignette on the full data set, you can skip this
chunk. The subsetting will keep all UPS proteins, known to be
differentially abundant by experimental design and we will keep 500
background proteins known to be unchanged across condition.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="load-data.html#cb8-1" tabindex="-1"></a>allProteins <span class="ot">&lt;-</span> <span class="fu">unique</span>(psms<span class="sc">$</span>Protein.Accessions)</span>
<span id="cb8-2"><a href="load-data.html#cb8-2" tabindex="-1"></a>upsProteins <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"ups"</span>, allProteins, <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-3"><a href="load-data.html#cb8-3" tabindex="-1"></a>helaProteins <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"ups"</span>, allProteins, <span class="at">value =</span> <span class="cn">TRUE</span>, <span class="at">invert =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-4"><a href="load-data.html#cb8-4" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb8-5"><a href="load-data.html#cb8-5" tabindex="-1"></a>keepProteins <span class="ot">&lt;-</span> <span class="fu">c</span>(upsProteins, <span class="fu">sample</span>(helaProteins, <span class="dv">500</span>))</span>
<span id="cb8-6"><a href="load-data.html#cb8-6" tabindex="-1"></a>psms <span class="ot">&lt;-</span> psms[psms<span class="sc">$</span>Protein.Accessions <span class="sc">%in%</span> keepProteins, ]</span></code></pre></div>
<p>Finally, we combine the data into a <code>QFeatures</code> object. We add two
annotation columns so that the <code>readQFeatures</code> function can link the
PSM to the corresponding quantification column within each run, see
<code>?readQFeatures()</code> for more details.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="load-data.html#cb9-1" tabindex="-1"></a>coldata<span class="sc">$</span>runCol <span class="ot">&lt;-</span> coldata<span class="sc">$</span>FileName</span>
<span id="cb9-2"><a href="load-data.html#cb9-2" tabindex="-1"></a>coldata<span class="sc">$</span>quantCols <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Abundance.."</span>, coldata<span class="sc">$</span>Channel)</span>
<span id="cb9-3"><a href="load-data.html#cb9-3" tabindex="-1"></a>spikein <span class="ot">&lt;-</span> <span class="fu">readQFeatures</span>(psms, <span class="at">colData =</span> coldata,</span>
<span id="cb9-4"><a href="load-data.html#cb9-4" tabindex="-1"></a>                         <span class="at">quantCols =</span> <span class="fu">unique</span>(coldata<span class="sc">$</span>quantCols),</span>
<span id="cb9-5"><a href="load-data.html#cb9-5" tabindex="-1"></a>                         <span class="at">runCol =</span> <span class="st">"Spectrum.File"</span>, <span class="at">name =</span> <span class="st">"psms"</span>)</span>
<span id="cb9-6"><a href="load-data.html#cb9-6" tabindex="-1"></a><span class="fu">names</span>(spikein) <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"^.*(Mix.*).raw"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="fu">names</span>(spikein))</span>
<span id="cb9-7"><a href="load-data.html#cb9-7" tabindex="-1"></a>spikein</span></code></pre></div>
<p>We now have a <code>QFeatures</code> object with 15 sets, each containing data
associated with an MS run.</p>
</div>
<p style="text-align: center;">
<a href="load-packages.html"><button class="btn btn-default">Previous</button></a>
<a href="data-preprocessing.html"><button class="btn btn-default">Next</button></a>
</p>
<p class="build-date">Page built: 
2025-09-03
 using 
R version 4.5.1 (2025-06-13)
</p>
</div>
</div>



</body>
</html>
