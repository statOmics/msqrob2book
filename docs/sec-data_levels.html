<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Chapter 4 PSM, peptide or protein-level modelling? | Statistical analysis for proteomics data" />
<meta property="og:type" content="book" />




<meta name="author" content="Christophe Vanderaa, Stijn Vandenbulcke, Lieven Clement" />

<meta name="date" content="2025-10-07" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="Chapter 4 PSM, peptide or protein-level modelling? | Statistical analysis for proteomics data">

<title>Chapter 4 PSM, peptide or protein-level modelling? | Statistical analysis for proteomics data</title>

<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/envisioned.css" rel="stylesheet" />
<link href="libs/msmb-css-0/msmb.css" rel="stylesheet" />
<script>
function toggle_visibility(id1, id2) {
var e = document.getElementById(id1);
var f = document.getElementById(id2);

e.style.display = ((e.style.display!='none') ? 'none' : 'block');

if(f.classList.contains('fa-plus-square')) {
    f.classList.add('fa-minus-square')
    f.classList.remove('fa-plus-square')
} else {
    f.classList.add('fa-plus-square')
    f.classList.remove('fa-minus-square')
}

}
</script>
<script>
function copy_link(id) {
  var dummy = document.createElement('input'),
  text = window.location.href.split(/[?#]/)[0] + '#' + id;
  document.body.appendChild(dummy);
  dummy.value = text;
  dummy.select();
  document.execCommand('copy');
  document.body.removeChild(dummy);
  
  var tooltip = document.getElementById(id + '-tooltip');
  tooltip.innerHTML = 'Copied!';
}

function reset_tooltip(id) {
  var tooltip = document.getElementById(id);
  tooltip.innerHTML = 'Copy link';
}
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }

code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul class="navbar">
<li class="msmb"><p class="title">Statistical analysis for proteomics data<p><p class="author">Christophe Vanderaa, Stijn Vandenbulcke, Lieven Clement</p>
<li class="dropdown" style="float:right">
<a href="javascript:void(0)" class="dropbtn">&#x25BE; Chapters</a>
<div class="dropdown-content">
<a href="index.html" id="toc-preamble"><span class="toc-section-number">1</span> Preamble</a>
<a href="sec-basics.html" id="toc-sec-basics"><span class="toc-section-number">2</span> Statistical analysis with msqrob2</a>
<a href="sec-advanced.html" id="toc-sec-advanced"><span class="toc-section-number">3</span> Advanced statistical analysis with msqrob2</a>
<a id="active-page" href="sec-data_levels.html#sec-data_levels" id="toc-sec-data_levels"><span class="toc-section-number">4</span> PSM, peptide or protein-level modelling?</a><ul class="toc-sections">
<li class="toc"><a href="#load-packages-2"> Load packages</a></li>
<li class="toc"><a href="#data-2"> Data</a></li>
<li class="toc"><a href="#data-preprocessing-1"> Data preprocessing</a></li>
<li class="toc"><a href="#data-modelling-1"> Data modelling</a></li>
<li class="toc"><a href="#performance-benchmark"> Performance benchmark</a></li>
</ul>
<a href="sec-francisella.html" id="toc-sec-francisella"><span class="toc-section-number">5</span> The francisella use case: a MaxQuant LFQ DDA dataset</a>
<a href="sec-mouse_diet.html#sec-mouse_diet" id="toc-sec-mouse_diet"><span class="toc-section-number">6</span> The mouse diet use case: a Skyline TMT DDA dataset</a>
<a href="sec-end.html" id="toc-sec-end"><span class="toc-section-number">7</span> Usefull links and session information</a>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="sec-data_levels" class="section level1" number="4">
<h1>
<span class="header-section-number">Chapter 4</span> PSM, peptide or protein-level modelling?</h1>
<p>In the previous chapters we have seen three different approaches to
model the data:</p>
<ol style="list-style-type: decimal">
<li>
<a href="sec-advanced.html#sec-tmt_protein_model">Approach 1</a>: start from a PSM-level table,
compute the protein summaries and model the data at the protein
level.</li>
<li>
<a href="sec-advanced.html#sec-tmt_ion_model">Approach 2</a>: start from a PSM-level table
and model the ion-level data to obtain protein-level results.</li>
<li>
<a href="sec-basics.html#sec-basics">Approach 3</a>: start from a peptide-level table,
compute the protein summaries and model the data at the protein
level.</li>
</ol>
<p>In this chapter, we will explore the differences in performance among
these approaches by reanalysing the Clinical Proteomic Tumor Analysis
Consortium <a href="sec-basics.html#sec-cptac_experiment">(CPTAC) data set</a>. For a
comprehensive comparison, we will also include the following
approaches:</p>
<ol start="4" style="list-style-type: decimal">
<li>Approach 4: start from a peptide-level table and model the
peptide-level data to obtain protein-level results.</li>
<li>Approach 5: start from a protein-level table (generated by MaxQuant
using maxLFQ) and model the protein-level data to obtain
protein-level results.</li>
</ol>
<p>Since the CPTAC data set is a spike-in experiment with known input
amounts, we will compare the performance of these approaches using the
ground truth. This chapter is therefore also a demonstration of how to
benchmark data analysis workflows.</p>
<div id="load-packages-2" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> Load packages<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('load-packages-2')" onmouseout="reset_tooltip('load-packages-2-tooltip')"><span class="tooltiptext" id="load-packages-2-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<p>We load the <code>msqrob2</code> package, along with additional packages for
data manipulation and visualisation.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="sec-data_levels.html#cb169-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"msqrob2"</span>)</span>
<span id="cb169-2"><a href="sec-data_levels.html#cb169-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb169-3"><a href="sec-data_levels.html#cb169-3" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyr"</span>)</span>
<span id="cb169-4"><a href="sec-data_levels.html#cb169-4" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb169-5"><a href="sec-data_levels.html#cb169-5" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"patchwork"</span>)</span></code></pre></div>
<p>We also configure the <a href="sec-basics.html#sec-parallel">parallelisation</a> framework.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="sec-data_levels.html#cb170-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"BiocParallel"</span>)</span>
<span id="cb170-2"><a href="sec-data_levels.html#cb170-2" tabindex="-1"></a><span class="fu">register</span>(<span class="fu">SerialParam</span>())</span>
<span id="cb170-3"><a href="sec-data_levels.html#cb170-3" tabindex="-1"></a><span class="fu">register</span>(<span class="fu">SnowParam</span>(<span class="at">workers =</span> <span class="dv">4</span>))</span></code></pre></div>
<p><strong>TODO</strong>: move function from utils to msqrob2</p>
</div>
<div id="data-2" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Data<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('data-2')" onmouseout="reset_tooltip('data-2-tooltip')"><span class="tooltiptext" id="data-2-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<div id="maxquant-tables" class="section level3" number="4.2.1">
<h3>
<span class="header-section-number">4.2.1</span> MaxQuant tables<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('maxquant-tables')" onmouseout="reset_tooltip('maxquant-tables-tooltip')"><span class="tooltiptext" id="maxquant-tables-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="sec-data_levels.html#cb171-1" tabindex="-1"></a>evidenceFile <span class="ot">&lt;-</span> <span class="st">"data/cptac/evidence.txt"</span></span>
<span id="cb171-2"><a href="sec-data_levels.html#cb171-2" tabindex="-1"></a>peptidesFile <span class="ot">&lt;-</span> <span class="st">"data/cptac/peptides.txt"</span></span>
<span id="cb171-3"><a href="sec-data_levels.html#cb171-3" tabindex="-1"></a>proteinGroupsFile <span class="ot">&lt;-</span> <span class="st">"data/cptac/proteinGroups.txt"</span></span></code></pre></div>
<p><strong>TODO</strong>: put data on Zenodo or MsDataHub</p>
</div>
<div id="annotation-table" class="section level3" number="4.2.2">
<h3>
<span class="header-section-number">4.2.2</span> Annotation table<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('annotation-table')" onmouseout="reset_tooltip('annotation-table-tooltip')"><span class="tooltiptext" id="annotation-table-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="sec-data_levels.html#cb172-1" tabindex="-1"></a>annotFile <span class="ot">&lt;-</span> <span class="st">"data/cptac/cptac_annotation.csv"</span></span>
<span id="cb172-2"><a href="sec-data_levels.html#cb172-2" tabindex="-1"></a>coldata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(annotFile)</span></code></pre></div>
</div>
</div>
<div id="data-preprocessing-1" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Data preprocessing<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('data-preprocessing-1')" onmouseout="reset_tooltip('data-preprocessing-1-tooltip')"><span class="tooltiptext" id="data-preprocessing-1-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<div id="the-preprocessing-workflow" class="section level3" number="4.3.1">
<h3>
<span class="header-section-number">4.3.1</span> The preprocessing workflow<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('the-preprocessing-workflow')" onmouseout="reset_tooltip('the-preprocessing-workflow-tooltip')"><span class="tooltiptext" id="the-preprocessing-workflow-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="sec-data_levels.html#cb173-1" tabindex="-1"></a>preprocessing_workflow <span class="ot">&lt;-</span> <span class="cf">function</span>(object, i, level) {</span>
<span id="cb173-2"><a href="sec-data_levels.html#cb173-2" tabindex="-1"></a>    level <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(level, <span class="fu">c</span>(<span class="st">"psm"</span>, <span class="st">"peptide"</span>, <span class="st">"protein"</span>))</span>
<span id="cb173-3"><a href="sec-data_levels.html#cb173-3" tabindex="-1"></a>    <span class="do">## Encode missing values</span></span>
<span id="cb173-4"><a href="sec-data_levels.html#cb173-4" tabindex="-1"></a>    object <span class="ot">&lt;-</span> <span class="fu">zeroIsNA</span>(object, i)</span>
<span id="cb173-5"><a href="sec-data_levels.html#cb173-5" tabindex="-1"></a>    <span class="do">## Log transformation</span></span>
<span id="cb173-6"><a href="sec-data_levels.html#cb173-6" tabindex="-1"></a>    logName <span class="ot">&lt;-</span> <span class="fu">paste0</span>(i, <span class="st">"_log"</span>)</span>
<span id="cb173-7"><a href="sec-data_levels.html#cb173-7" tabindex="-1"></a>    object <span class="ot">&lt;-</span> <span class="fu">logTransform</span>(object, i, <span class="at">name =</span> logName, <span class="at">base =</span> <span class="dv">2</span>)</span>
<span id="cb173-8"><a href="sec-data_levels.html#cb173-8" tabindex="-1"></a>    <span class="do">## PSM filtering (only for psm-level data)</span></span>
<span id="cb173-9"><a href="sec-data_levels.html#cb173-9" tabindex="-1"></a>    <span class="cf">if</span> (level <span class="sc">==</span> <span class="st">"psm"</span>) {</span>
<span id="cb173-10"><a href="sec-data_levels.html#cb173-10" tabindex="-1"></a>        <span class="cf">for</span> (ii <span class="cf">in</span> logName) {</span>
<span id="cb173-11"><a href="sec-data_levels.html#cb173-11" tabindex="-1"></a>            rowdata <span class="ot">&lt;-</span> <span class="fu">rowData</span>(object[[ii]]) </span>
<span id="cb173-12"><a href="sec-data_levels.html#cb173-12" tabindex="-1"></a>            rowdata<span class="sc">$</span>ionID <span class="ot">&lt;-</span> <span class="fu">paste0</span>(rowdata<span class="sc">$</span>Sequence, rowdata<span class="sc">$</span>Charge) </span>
<span id="cb173-13"><a href="sec-data_levels.html#cb173-13" tabindex="-1"></a>            rowdata<span class="sc">$</span>rowSums <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="fu">assay</span>(object[[ii]]), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb173-14"><a href="sec-data_levels.html#cb173-14" tabindex="-1"></a>            rowdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(rowdata) <span class="sc">|&gt;</span></span>
<span id="cb173-15"><a href="sec-data_levels.html#cb173-15" tabindex="-1"></a>                <span class="fu">group_by</span>(ionID) <span class="sc">|&gt;</span></span>
<span id="cb173-16"><a href="sec-data_levels.html#cb173-16" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">psmRank =</span> <span class="fu">rank</span>(<span class="sc">-</span>rowSums))</span>
<span id="cb173-17"><a href="sec-data_levels.html#cb173-17" tabindex="-1"></a>            <span class="fu">rowData</span>(object[[ii]]) <span class="ot">&lt;-</span> <span class="fu">DataFrame</span>(rowdata)    </span>
<span id="cb173-18"><a href="sec-data_levels.html#cb173-18" tabindex="-1"></a>        }</span>
<span id="cb173-19"><a href="sec-data_levels.html#cb173-19" tabindex="-1"></a>        object <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(object, <span class="sc">~</span> psmRank <span class="sc">==</span> <span class="dv">1</span>, <span class="at">keep =</span> <span class="cn">TRUE</span>)</span>
<span id="cb173-20"><a href="sec-data_levels.html#cb173-20" tabindex="-1"></a>        i <span class="ot">&lt;-</span> <span class="st">"evidence"</span></span>
<span id="cb173-21"><a href="sec-data_levels.html#cb173-21" tabindex="-1"></a>        joinName <span class="ot">&lt;-</span> <span class="fu">paste0</span>(i, <span class="st">"_log"</span>)</span>
<span id="cb173-22"><a href="sec-data_levels.html#cb173-22" tabindex="-1"></a>        object <span class="ot">&lt;-</span> <span class="fu">joinAssays</span>(object, logName, joinName, <span class="st">"ionID"</span>)</span>
<span id="cb173-23"><a href="sec-data_levels.html#cb173-23" tabindex="-1"></a>        logName <span class="ot">&lt;-</span> joinName </span>
<span id="cb173-24"><a href="sec-data_levels.html#cb173-24" tabindex="-1"></a>    </span>
<span id="cb173-25"><a href="sec-data_levels.html#cb173-25" tabindex="-1"></a>    }</span>
<span id="cb173-26"><a href="sec-data_levels.html#cb173-26" tabindex="-1"></a>    <span class="do">## Feature filtering</span></span>
<span id="cb173-27"><a href="sec-data_levels.html#cb173-27" tabindex="-1"></a>    <span class="cf">if</span> (level <span class="sc">==</span> <span class="st">"protein"</span>) { </span>
<span id="cb173-28"><a href="sec-data_levels.html#cb173-28" tabindex="-1"></a>        <span class="do">## So we need to match the protein ID in the evidence/peptide</span></span>
<span id="cb173-29"><a href="sec-data_levels.html#cb173-29" tabindex="-1"></a>        <span class="do">## table with the protiein ID in the protein group table</span></span>
<span id="cb173-30"><a href="sec-data_levels.html#cb173-30" tabindex="-1"></a>        rowdata <span class="ot">&lt;-</span> <span class="fu">rbindRowData</span>(object, <span class="fu">names</span>(object))</span>
<span id="cb173-31"><a href="sec-data_levels.html#cb173-31" tabindex="-1"></a>        rowdata<span class="sc">$</span>Proteins <span class="ot">&lt;-</span> rowdata<span class="sc">$</span>Protein.IDs</span>
<span id="cb173-32"><a href="sec-data_levels.html#cb173-32" tabindex="-1"></a>        <span class="fu">rowData</span>(object) <span class="ot">&lt;-</span> <span class="fu">split</span>(rowdata, rowdata<span class="sc">$</span>assay)</span>
<span id="cb173-33"><a href="sec-data_levels.html#cb173-33" tabindex="-1"></a>    }</span>
<span id="cb173-34"><a href="sec-data_levels.html#cb173-34" tabindex="-1"></a>    object <span class="ot">&lt;-</span> <span class="fu">filterFeatures</span>(</span>
<span id="cb173-35"><a href="sec-data_levels.html#cb173-35" tabindex="-1"></a>        object, <span class="sc">~</span> Proteins <span class="sc">!=</span> <span class="st">""</span> <span class="sc">&amp;</span> <span class="do">## Remove failed protein inference</span></span>
<span id="cb173-36"><a href="sec-data_levels.html#cb173-36" tabindex="-1"></a>            Proteins <span class="sc">%in%</span> <span class="fu">smallestUniqueGroups</span>(Proteins) <span class="sc">&amp;</span> <span class="do">## Remove protein groups</span></span>
<span id="cb173-37"><a href="sec-data_levels.html#cb173-37" tabindex="-1"></a>            Reverse <span class="sc">!=</span> <span class="st">"+"</span> <span class="sc">&amp;</span> <span class="do">## Remove decoys</span></span>
<span id="cb173-38"><a href="sec-data_levels.html#cb173-38" tabindex="-1"></a>            (Potential.contaminant <span class="sc">!=</span> <span class="st">"+"</span>) <span class="sc">|</span> <span class="do">## Remove contaminants</span></span>
<span id="cb173-39"><a href="sec-data_levels.html#cb173-39" tabindex="-1"></a>            <span class="fu">grepl</span>(<span class="st">"ups"</span>, Proteins) <span class="do">## always keep UPS-1 proteins (some are listed as contaminants)</span></span>
<span id="cb173-40"><a href="sec-data_levels.html#cb173-40" tabindex="-1"></a>    )</span>
<span id="cb173-41"><a href="sec-data_levels.html#cb173-41" tabindex="-1"></a>    <span class="do">## The steps below are not for protein data</span></span>
<span id="cb173-42"><a href="sec-data_levels.html#cb173-42" tabindex="-1"></a>    <span class="cf">if</span> (level <span class="sc">==</span> <span class="st">"protein"</span>) <span class="fu">return</span>(object)</span>
<span id="cb173-43"><a href="sec-data_levels.html#cb173-43" tabindex="-1"></a>    <span class="do">## Missing value filtering (only to avoid complains from robustSummary)</span></span>
<span id="cb173-44"><a href="sec-data_levels.html#cb173-44" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(object[[logName]])</span>
<span id="cb173-45"><a href="sec-data_levels.html#cb173-45" tabindex="-1"></a>    object <span class="ot">&lt;-</span> <span class="fu">filterNA</span>(object, <span class="at">i =</span> logName, <span class="at">pNA =</span> (n <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">/</span> n)</span>
<span id="cb173-46"><a href="sec-data_levels.html#cb173-46" tabindex="-1"></a>    <span class="do">## Normalisation</span></span>
<span id="cb173-47"><a href="sec-data_levels.html#cb173-47" tabindex="-1"></a>    normName <span class="ot">&lt;-</span> <span class="fu">paste0</span>(i, <span class="st">"_norm"</span>)</span>
<span id="cb173-48"><a href="sec-data_levels.html#cb173-48" tabindex="-1"></a>    object <span class="ot">&lt;-</span> <span class="fu">normalize</span>(</span>
<span id="cb173-49"><a href="sec-data_levels.html#cb173-49" tabindex="-1"></a>        object, logName, <span class="at">name =</span> normName, <span class="at">method =</span> <span class="st">"center.median"</span></span>
<span id="cb173-50"><a href="sec-data_levels.html#cb173-50" tabindex="-1"></a>    )</span>
<span id="cb173-51"><a href="sec-data_levels.html#cb173-51" tabindex="-1"></a>    <span class="do">## Summarisation</span></span>
<span id="cb173-52"><a href="sec-data_levels.html#cb173-52" tabindex="-1"></a>    summName <span class="ot">&lt;-</span> <span class="fu">paste0</span>(i, <span class="st">"_proteins"</span>)</span>
<span id="cb173-53"><a href="sec-data_levels.html#cb173-53" tabindex="-1"></a>    <span class="fu">aggregateFeatures</span>(</span>
<span id="cb173-54"><a href="sec-data_levels.html#cb173-54" tabindex="-1"></a>        object, <span class="at">i =</span> normName, <span class="at">name =</span> summName, <span class="at">fcol =</span> <span class="st">"Proteins"</span>,</span>
<span id="cb173-55"><a href="sec-data_levels.html#cb173-55" tabindex="-1"></a>        <span class="at">fun =</span> MsCoreUtils<span class="sc">::</span>robustSummary, </span>
<span id="cb173-56"><a href="sec-data_levels.html#cb173-56" tabindex="-1"></a>        <span class="co"># fun = MsCoreUtils::medianPolish, </span></span>
<span id="cb173-57"><a href="sec-data_levels.html#cb173-57" tabindex="-1"></a>        <span class="co"># na.rm = TRUE</span></span>
<span id="cb173-58"><a href="sec-data_levels.html#cb173-58" tabindex="-1"></a>    )</span>
<span id="cb173-59"><a href="sec-data_levels.html#cb173-59" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>NOTE</strong>: I thought removing lab1 (contains ionisation issues) to
improve the results, but this would lead to an unfair comparison
because maxLFQ has already been computed and combines the data from
all samples (hence all labs).</p>
<p><strong>TODO</strong>: robust summary fails because “contrasts can be applied only
to factors with 2 or more levels”.</p>
<p><strong>TODO</strong>: Discuss - we need to apply a stringent NA filtering to
ensure differences in performance are not due to difference in
available data due to our missing values filters.</p>
<p><strong>TODO</strong>: MaxQuant is doing weird stuff with protein IDs… Eg TAL1_YEAST is not part
of a protein group, whereas it is part of a protein group with TAL2 in
the protein table… See here:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="sec-data_levels.html#cb174-1" tabindex="-1"></a><span class="fu">rowData</span>(peptides[[<span class="st">"peptides"</span>]]) <span class="sc">|&gt;</span></span>
<span id="cb174-2"><a href="sec-data_levels.html#cb174-2" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb174-3"><a href="sec-data_levels.html#cb174-3" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"TAL._YEAST"</span>, Proteins)) <span class="sc">|&gt;</span></span>
<span id="cb174-4"><a href="sec-data_levels.html#cb174-4" tabindex="-1"></a>    <span class="fu">select</span>(Leading.razor.protein, Proteins)</span>
<span id="cb174-5"><a href="sec-data_levels.html#cb174-5" tabindex="-1"></a><span class="fu">rowData</span>(proteins[[<span class="st">"proteins"</span>]]) <span class="sc">|&gt;</span></span>
<span id="cb174-6"><a href="sec-data_levels.html#cb174-6" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb174-7"><a href="sec-data_levels.html#cb174-7" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"TAL._YEAST"</span>, Majority.protein.IDs)) <span class="sc">|&gt;</span></span>
<span id="cb174-8"><a href="sec-data_levels.html#cb174-8" tabindex="-1"></a>    <span class="fu">select</span>(Protein.IDs, Majority.protein.IDs)</span></code></pre></div>
</div>
<div id="evidence-data" class="section level3" number="4.3.2">
<h3>
<span class="header-section-number">4.3.2</span> Evidence data<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('evidence-data')" onmouseout="reset_tooltip('evidence-data-tooltip')"><span class="tooltiptext" id="evidence-data-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="sec-data_levels.html#cb175-1" tabindex="-1"></a>evidence <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(evidenceFile)</span>
<span id="cb175-2"><a href="sec-data_levels.html#cb175-2" tabindex="-1"></a>coldata<span class="sc">$</span>runCol <span class="ot">&lt;-</span> coldata<span class="sc">$</span>Raw.file</span>
<span id="cb175-3"><a href="sec-data_levels.html#cb175-3" tabindex="-1"></a>evidence <span class="ot">&lt;-</span> <span class="fu">readQFeatures</span>(</span>
<span id="cb175-4"><a href="sec-data_levels.html#cb175-4" tabindex="-1"></a>    evidence, <span class="at">colData =</span> coldata, <span class="at">runCol =</span> <span class="st">"Raw.file"</span>, </span>
<span id="cb175-5"><a href="sec-data_levels.html#cb175-5" tabindex="-1"></a>    <span class="at">quantCols =</span> <span class="st">"Intensity"</span></span>
<span id="cb175-6"><a href="sec-data_levels.html#cb175-6" tabindex="-1"></a>)</span>
<span id="cb175-7"><a href="sec-data_levels.html#cb175-7" tabindex="-1"></a>evidence <span class="ot">&lt;-</span> <span class="fu">preprocessing_workflow</span>(</span>
<span id="cb175-8"><a href="sec-data_levels.html#cb175-8" tabindex="-1"></a>    evidence, <span class="fu">names</span>(evidence), <span class="at">level =</span> <span class="st">"psm"</span></span>
<span id="cb175-9"><a href="sec-data_levels.html#cb175-9" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="peptides-file" class="section level3" number="4.3.3">
<h3>
<span class="header-section-number">4.3.3</span> Peptides file<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('peptides-file')" onmouseout="reset_tooltip('peptides-file-tooltip')"><span class="tooltiptext" id="peptides-file-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="sec-data_levels.html#cb176-1" tabindex="-1"></a>peptides <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(peptidesFile)</span>
<span id="cb176-2"><a href="sec-data_levels.html#cb176-2" tabindex="-1"></a>coldata<span class="sc">$</span>quantCols <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"Intensity."</span>, coldata<span class="sc">$</span>sample)</span>
<span id="cb176-3"><a href="sec-data_levels.html#cb176-3" tabindex="-1"></a>peptides <span class="ot">&lt;-</span> <span class="fu">readQFeatures</span>(</span>
<span id="cb176-4"><a href="sec-data_levels.html#cb176-4" tabindex="-1"></a>    peptides, <span class="at">colData =</span> coldata, <span class="at">name =</span> <span class="st">"peptides"</span>, </span>
<span id="cb176-5"><a href="sec-data_levels.html#cb176-5" tabindex="-1"></a>    <span class="at">fnames =</span> <span class="st">"Sequence"</span></span>
<span id="cb176-6"><a href="sec-data_levels.html#cb176-6" tabindex="-1"></a>)</span>
<span id="cb176-7"><a href="sec-data_levels.html#cb176-7" tabindex="-1"></a>peptides <span class="ot">&lt;-</span> <span class="fu">preprocessing_workflow</span>(</span>
<span id="cb176-8"><a href="sec-data_levels.html#cb176-8" tabindex="-1"></a>    peptides, <span class="st">"peptides"</span>, <span class="at">level =</span> <span class="st">"peptide"</span></span>
<span id="cb176-9"><a href="sec-data_levels.html#cb176-9" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="proteingroups-data" class="section level3" number="4.3.4">
<h3>
<span class="header-section-number">4.3.4</span> ProteinGroups data<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('proteingroups-data')" onmouseout="reset_tooltip('proteingroups-data-tooltip')"><span class="tooltiptext" id="proteingroups-data-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="sec-data_levels.html#cb177-1" tabindex="-1"></a>proteinGroups <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(proteinGroupsFile)</span>
<span id="cb177-2"><a href="sec-data_levels.html#cb177-2" tabindex="-1"></a>proteinGroups <span class="ot">&lt;-</span> <span class="fu">readQFeatures</span>(</span>
<span id="cb177-3"><a href="sec-data_levels.html#cb177-3" tabindex="-1"></a>    proteinGroups, <span class="at">colData =</span> coldata, <span class="at">name =</span> <span class="st">"proteinGroups"</span>,</span>
<span id="cb177-4"><a href="sec-data_levels.html#cb177-4" tabindex="-1"></a>    <span class="at">fnames =</span> <span class="st">"Protein.IDs"</span></span>
<span id="cb177-5"><a href="sec-data_levels.html#cb177-5" tabindex="-1"></a>)</span>
<span id="cb177-6"><a href="sec-data_levels.html#cb177-6" tabindex="-1"></a>proteinGroups <span class="ot">&lt;-</span> <span class="fu">preprocessing_workflow</span>(</span>
<span id="cb177-7"><a href="sec-data_levels.html#cb177-7" tabindex="-1"></a>    proteinGroups, <span class="st">"proteinGroups"</span>, <span class="at">level =</span> <span class="st">"protein"</span></span>
<span id="cb177-8"><a href="sec-data_levels.html#cb177-8" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="sec-data_levels.html#cb178-1" tabindex="-1"></a>cptac <span class="ot">&lt;-</span> <span class="fu">c</span>(evidence, peptides, proteinGroups)</span></code></pre></div>
</div>
</div>
<div id="data-modelling-1" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Data modelling<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('data-modelling-1')" onmouseout="reset_tooltip('data-modelling-1-tooltip')"><span class="tooltiptext" id="data-modelling-1-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<div id="model-definition" class="section level3" number="4.4.1">
<h3>
<span class="header-section-number">4.4.1</span> Model definition<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('model-definition')" onmouseout="reset_tooltip('model-definition-tooltip')"><span class="tooltiptext" id="model-definition-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="sec-data_levels.html#cb179-1" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb179-2"><a href="sec-data_levels.html#cb179-2" tabindex="-1"></a>    <span class="at">psm =</span> <span class="sc">~</span> condition <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> lab) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> sample) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ionID), </span>
<span id="cb179-3"><a href="sec-data_levels.html#cb179-3" tabindex="-1"></a>    <span class="at">peptide =</span> <span class="sc">~</span> condition <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> lab) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> sample) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> Sequence), </span>
<span id="cb179-4"><a href="sec-data_levels.html#cb179-4" tabindex="-1"></a>    <span class="at">protein =</span> <span class="sc">~</span> condition <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> lab)</span>
<span id="cb179-5"><a href="sec-data_levels.html#cb179-5" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="hypothesis-testing-2" class="section level3" number="4.4.2">
<h3>
<span class="header-section-number">4.4.2</span> Hypothesis testing<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('hypothesis-testing-2')" onmouseout="reset_tooltip('hypothesis-testing-2-tooltip')"><span class="tooltiptext" id="hypothesis-testing-2-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<p>The same contrasts are shared across approaches</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="sec-data_levels.html#cb180-1" tabindex="-1"></a>allContrasts <span class="ot">&lt;-</span> <span class="fu">createPairwiseContrasts</span>(</span>
<span id="cb180-2"><a href="sec-data_levels.html#cb180-2" tabindex="-1"></a>    models<span class="sc">$</span>protein, <span class="fu">colData</span>(cptac), <span class="at">var =</span> <span class="st">"condition"</span>, <span class="at">ridge =</span> <span class="cn">TRUE</span></span>
<span id="cb180-3"><a href="sec-data_levels.html#cb180-3" tabindex="-1"></a>)</span>
<span id="cb180-4"><a href="sec-data_levels.html#cb180-4" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">makeContrast</span>(</span>
<span id="cb180-5"><a href="sec-data_levels.html#cb180-5" tabindex="-1"></a>    allContrasts, </span>
<span id="cb180-6"><a href="sec-data_levels.html#cb180-6" tabindex="-1"></a>    <span class="fu">.getParamNames</span>(</span>
<span id="cb180-7"><a href="sec-data_levels.html#cb180-7" tabindex="-1"></a>        models<span class="sc">$</span>protein, <span class="fu">colData</span>(cptac), <span class="at">var =</span> <span class="st">"condition"</span>, <span class="at">ridge =</span> <span class="cn">TRUE</span></span>
<span id="cb180-8"><a href="sec-data_levels.html#cb180-8" tabindex="-1"></a>    )</span>
<span id="cb180-9"><a href="sec-data_levels.html#cb180-9" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="the-modelling-workflow" class="section level3" number="4.4.3">
<h3>
<span class="header-section-number">4.4.3</span> The modelling workflow<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('the-modelling-workflow')" onmouseout="reset_tooltip('the-modelling-workflow-tooltip')"><span class="tooltiptext" id="the-modelling-workflow-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="sec-data_levels.html#cb181-1" tabindex="-1"></a>modelling_workflow <span class="ot">&lt;-</span> <span class="cf">function</span>(object, i, model, L, <span class="at">fcol =</span> <span class="cn">NA</span>) {</span>
<span id="cb181-2"><a href="sec-data_levels.html#cb181-2" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(fcol)) {</span>
<span id="cb181-3"><a href="sec-data_levels.html#cb181-3" tabindex="-1"></a>        object <span class="ot">&lt;-</span> <span class="fu">msqrob</span>(</span>
<span id="cb181-4"><a href="sec-data_levels.html#cb181-4" tabindex="-1"></a>            object,  <span class="at">i =</span> i, <span class="at">formula =</span> model,</span>
<span id="cb181-5"><a href="sec-data_levels.html#cb181-5" tabindex="-1"></a>            <span class="at">ridge =</span> <span class="cn">TRUE</span>, <span class="at">robust =</span> <span class="cn">TRUE</span></span>
<span id="cb181-6"><a href="sec-data_levels.html#cb181-6" tabindex="-1"></a>        )</span>
<span id="cb181-7"><a href="sec-data_levels.html#cb181-7" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb181-8"><a href="sec-data_levels.html#cb181-8" tabindex="-1"></a>        object <span class="ot">&lt;-</span> <span class="fu">msqrobAggregate</span>(</span>
<span id="cb181-9"><a href="sec-data_levels.html#cb181-9" tabindex="-1"></a>            object,  <span class="at">i =</span> i, <span class="at">formula =</span> model, </span>
<span id="cb181-10"><a href="sec-data_levels.html#cb181-10" tabindex="-1"></a>            <span class="at">fcol =</span> fcol, <span class="at">name =</span> <span class="st">"msqrob"</span>,</span>
<span id="cb181-11"><a href="sec-data_levels.html#cb181-11" tabindex="-1"></a>            <span class="at">robust =</span> <span class="cn">TRUE</span>, <span class="at">ridge =</span> <span class="cn">TRUE</span></span>
<span id="cb181-12"><a href="sec-data_levels.html#cb181-12" tabindex="-1"></a>        )</span>
<span id="cb181-13"><a href="sec-data_levels.html#cb181-13" tabindex="-1"></a>        i <span class="ot">&lt;-</span> <span class="st">"msqrob"</span></span>
<span id="cb181-14"><a href="sec-data_levels.html#cb181-14" tabindex="-1"></a>    }</span>
<span id="cb181-15"><a href="sec-data_levels.html#cb181-15" tabindex="-1"></a>    object <span class="ot">&lt;-</span> <span class="fu">hypothesisTest</span>(object, i, <span class="at">contrast =</span> L)</span>
<span id="cb181-16"><a href="sec-data_levels.html#cb181-16" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">msqrobCollect</span>(object[[i]], L, <span class="at">combine =</span> <span class="cn">TRUE</span>)</span>
<span id="cb181-17"><a href="sec-data_levels.html#cb181-17" tabindex="-1"></a>    out</span>
<span id="cb181-18"><a href="sec-data_levels.html#cb181-18" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="sec-data_levels.html#cb182-1" tabindex="-1"></a>(approaches <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb182-2"><a href="sec-data_levels.html#cb182-2" tabindex="-1"></a>    <span class="at">inputLevel =</span> <span class="fu">c</span>(<span class="st">"psm"</span>, <span class="st">"psm"</span>, <span class="st">"peptide"</span>, <span class="st">"peptide"</span>, <span class="st">"protein"</span>),</span>
<span id="cb182-3"><a href="sec-data_levels.html#cb182-3" tabindex="-1"></a>    <span class="at">modelLevel =</span> <span class="fu">c</span>(<span class="st">"protein"</span>, <span class="st">"psm"</span>, <span class="st">"protein"</span>, <span class="st">"peptide"</span>, <span class="st">"protein"</span>),</span>
<span id="cb182-4"><a href="sec-data_levels.html#cb182-4" tabindex="-1"></a>    <span class="at">set =</span> <span class="fu">c</span>(<span class="st">"evidence_proteins"</span>, <span class="st">"evidence_norm"</span>, <span class="st">"peptides_proteins"</span>, <span class="st">"peptides_norm"</span>, <span class="st">"proteinGroups_log"</span>),</span>
<span id="cb182-5"><a href="sec-data_levels.html#cb182-5" tabindex="-1"></a>    <span class="at">fcol =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">"Proteins"</span>, <span class="cn">NA</span>, <span class="st">"Proteins"</span>, <span class="cn">NA</span>)</span>
<span id="cb182-6"><a href="sec-data_levels.html#cb182-6" tabindex="-1"></a>))</span></code></pre></div>
<pre><code>##   inputLevel modelLevel               set     fcol
## 1        psm    protein evidence_proteins     &lt;NA&gt;
## 2        psm        psm     evidence_norm Proteins
## 3    peptide    protein peptides_proteins     &lt;NA&gt;
## 4    peptide    peptide     peptides_norm Proteins
## 5    protein    protein proteinGroups_log     &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="sec-data_levels.html#cb184-1" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">apply</span>(approaches, <span class="dv">1</span>, <span class="cf">function</span>(x) {</span>
<span id="cb184-2"><a href="sec-data_levels.html#cb184-2" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">modelling_workflow</span>(</span>
<span id="cb184-3"><a href="sec-data_levels.html#cb184-3" tabindex="-1"></a>        cptac, <span class="at">i =</span> x[[<span class="st">"set"</span>]], <span class="at">model =</span> models[[x[[<span class="st">"modelLevel"</span>]]]],</span>
<span id="cb184-4"><a href="sec-data_levels.html#cb184-4" tabindex="-1"></a>        <span class="at">L =</span> L, <span class="at">fcol =</span> x[[<span class="st">"fcol"</span>]]</span>
<span id="cb184-5"><a href="sec-data_levels.html#cb184-5" tabindex="-1"></a>    )</span>
<span id="cb184-6"><a href="sec-data_levels.html#cb184-6" tabindex="-1"></a>    out<span class="sc">$</span>modelLevel <span class="ot">&lt;-</span> x[[<span class="st">"modelLevel"</span>]]</span>
<span id="cb184-7"><a href="sec-data_levels.html#cb184-7" tabindex="-1"></a>    out<span class="sc">$</span>inputLevel <span class="ot">&lt;-</span> x[[<span class="st">"set"</span>]]</span>
<span id="cb184-8"><a href="sec-data_levels.html#cb184-8" tabindex="-1"></a>    out</span>
<span id="cb184-9"><a href="sec-data_levels.html#cb184-9" tabindex="-1"></a>})</span>
<span id="cb184-10"><a href="sec-data_levels.html#cb184-10" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, results)</span></code></pre></div>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="sec-data_levels.html#cb185-1" tabindex="-1"></a>results<span class="sc">$</span>isUps <span class="ot">&lt;-</span> <span class="fu">grepl</span>(<span class="st">"ups"</span>, results<span class="sc">$</span>feature)</span>
<span id="cb185-2"><a href="sec-data_levels.html#cb185-2" tabindex="-1"></a>results<span class="sc">$</span>contrast <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"ridgecondition"</span>, <span class="st">""</span>, results<span class="sc">$</span>contrast)</span>
<span id="cb185-3"><a href="sec-data_levels.html#cb185-3" tabindex="-1"></a>results<span class="sc">$</span>contrast <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"^(6[B-E])$"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1 - 6A"</span>, results<span class="sc">$</span>contrast)</span></code></pre></div>
</div>
</div>
<div id="performance-benchmark" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> Performance benchmark<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('performance-benchmark')" onmouseout="reset_tooltip('performance-benchmark-tooltip')"><span class="tooltiptext" id="performance-benchmark-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h2>
<div id="number-of-fits" class="section level3" number="4.5.1">
<h3>
<span class="header-section-number">4.5.1</span> Number of fits<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('number-of-fits')" onmouseout="reset_tooltip('number-of-fits-tooltip')"><span class="tooltiptext" id="number-of-fits-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="sec-data_levels.html#cb186-1" tabindex="-1"></a><span class="fu">group_by</span>(results, inputLevel) <span class="sc">|&gt;</span> </span>
<span id="cb186-2"><a href="sec-data_levels.html#cb186-2" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(adjPval))) <span class="sc">|&gt;</span> </span>
<span id="cb186-3"><a href="sec-data_levels.html#cb186-3" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb186-4"><a href="sec-data_levels.html#cb186-4" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> inputLevel, <span class="at">y =</span> n, <span class="at">fill =</span> inputLevel) <span class="sc">+</span></span>
<span id="cb186-5"><a href="sec-data_levels.html#cb186-5" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>)</span></code></pre></div>
<p><img src="msqrob2_book_files/figure-html/unnamed-chunk-207-1.png" width="672"></p>
</div>
<div id="tpr-fdp-curves" class="section level3" number="4.5.2">
<h3>
<span class="header-section-number">4.5.2</span> TPR-FDP curves<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('tpr-fdp-curves')" onmouseout="reset_tooltip('tpr-fdp-curves-tooltip')"><span class="tooltiptext" id="tpr-fdp-curves-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="sec-data_levels.html#cb187-1" tabindex="-1"></a>computeFDP <span class="ot">&lt;-</span> <span class="cf">function</span>(pval, tp) {</span>
<span id="cb187-2"><a href="sec-data_levels.html#cb187-2" tabindex="-1"></a>    ord <span class="ot">&lt;-</span> <span class="fu">order</span>(pval)</span>
<span id="cb187-3"><a href="sec-data_levels.html#cb187-3" tabindex="-1"></a>    fdp <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(<span class="sc">!</span>tp[ord]) <span class="sc">/</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tp)</span>
<span id="cb187-4"><a href="sec-data_levels.html#cb187-4" tabindex="-1"></a>    fdp[<span class="fu">order</span>(ord)]</span>
<span id="cb187-5"><a href="sec-data_levels.html#cb187-5" tabindex="-1"></a>}</span>
<span id="cb187-6"><a href="sec-data_levels.html#cb187-6" tabindex="-1"></a>computeTPR <span class="ot">&lt;-</span> <span class="cf">function</span>(pval, tp, <span class="at">nTP =</span> <span class="cn">NULL</span>) {</span>
<span id="cb187-7"><a href="sec-data_levels.html#cb187-7" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(nTP)) nTP <span class="ot">&lt;-</span> <span class="fu">sum</span>(tp)</span>
<span id="cb187-8"><a href="sec-data_levels.html#cb187-8" tabindex="-1"></a>    ord <span class="ot">&lt;-</span> <span class="fu">order</span>(pval)</span>
<span id="cb187-9"><a href="sec-data_levels.html#cb187-9" tabindex="-1"></a>    tpr <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(tp[ord]) <span class="sc">/</span> nTP</span>
<span id="cb187-10"><a href="sec-data_levels.html#cb187-10" tabindex="-1"></a>    tpr[<span class="fu">order</span>(ord)]</span>
<span id="cb187-11"><a href="sec-data_levels.html#cb187-11" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="sec-data_levels.html#cb188-1" tabindex="-1"></a>performance <span class="ot">&lt;-</span> <span class="fu">group_by</span>(results, inputLevel, contrast) <span class="sc">|&gt;</span> </span>
<span id="cb188-2"><a href="sec-data_levels.html#cb188-2" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(adjPval)) <span class="sc">|&gt;</span></span>
<span id="cb188-3"><a href="sec-data_levels.html#cb188-3" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">tpr =</span> <span class="fu">computeTPR</span>(pval, isUps),</span>
<span id="cb188-4"><a href="sec-data_levels.html#cb188-4" tabindex="-1"></a>           <span class="at">fdp =</span> <span class="fu">computeFDP</span>(pval, isUps)) <span class="sc">|&gt;</span></span>
<span id="cb188-5"><a href="sec-data_levels.html#cb188-5" tabindex="-1"></a>    <span class="fu">arrange</span>(fdp)</span></code></pre></div>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="sec-data_levels.html#cb189-1" tabindex="-1"></a>workPoints <span class="ot">&lt;-</span> <span class="fu">group_by</span>(performance, inputLevel, contrast) <span class="sc">|&gt;</span></span>
<span id="cb189-2"><a href="sec-data_levels.html#cb189-2" tabindex="-1"></a>    <span class="fu">filter</span>(adjPval <span class="sc">&lt;</span> <span class="fl">0.05</span>) <span class="sc">|&gt;</span></span>
<span id="cb189-3"><a href="sec-data_levels.html#cb189-3" tabindex="-1"></a>    <span class="fu">slice_max</span>(adjPval) <span class="sc">|&gt;</span></span>
<span id="cb189-4"><a href="sec-data_levels.html#cb189-4" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">duplicated</span>(inputLevel))</span></code></pre></div>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="sec-data_levels.html#cb190-1" tabindex="-1"></a><span class="fu">ggplot</span>(performance) <span class="sc">+</span></span>
<span id="cb190-2"><a href="sec-data_levels.html#cb190-2" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> fdp,</span>
<span id="cb190-3"><a href="sec-data_levels.html#cb190-3" tabindex="-1"></a>        <span class="at">x =</span> tpr,</span>
<span id="cb190-4"><a href="sec-data_levels.html#cb190-4" tabindex="-1"></a>        <span class="at">colour =</span> inputLevel) <span class="sc">+</span></span>
<span id="cb190-5"><a href="sec-data_levels.html#cb190-5" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb190-6"><a href="sec-data_levels.html#cb190-6" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> workPoints, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb190-7"><a href="sec-data_levels.html#cb190-7" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.05</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb190-8"><a href="sec-data_levels.html#cb190-8" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> contrast) <span class="sc">+</span></span>
<span id="cb190-9"><a href="sec-data_levels.html#cb190-9" tabindex="-1"></a>    <span class="fu">coord_flip</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb190-10"><a href="sec-data_levels.html#cb190-10" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div>
<p><img src="msqrob2_book_files/figure-html/unnamed-chunk-211-1.png" width="960"></p>
</div>
<div id="tp-and-fp-at-5-fdr" class="section level3" number="4.5.3">
<h3>
<span class="header-section-number">4.5.3</span> TP and FP at 5% FDR<div class="tooltip"><button class="internal-link-btn" onclick="copy_link('tp-and-fp-at-5-fdr')" onmouseout="reset_tooltip('tp-and-fp-at-5-fdr-tooltip')"><span class="tooltiptext" id="tp-and-fp-at-5-fdr-tooltip">Copy link</span><i class="fa fa-link"></i></button></div>
</h3>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="sec-data_levels.html#cb191-1" tabindex="-1"></a>tpFpTable <span class="ot">&lt;-</span> <span class="fu">group_by</span>(results, inputLevel, contrast) <span class="sc">|&gt;</span></span>
<span id="cb191-2"><a href="sec-data_levels.html#cb191-2" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(adjPval)) <span class="sc">|&gt;</span></span>
<span id="cb191-3"><a href="sec-data_levels.html#cb191-3" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="st">"True Positives"</span> <span class="ot">=</span> <span class="fu">sum</span>(adjPval <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> isUps),</span>
<span id="cb191-4"><a href="sec-data_levels.html#cb191-4" tabindex="-1"></a>              <span class="st">"False Positives"</span> <span class="ot">=</span> <span class="fu">sum</span>(adjPval <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> <span class="sc">!</span>isUps)) <span class="sc">|&gt;</span></span>
<span id="cb191-5"><a href="sec-data_levels.html#cb191-5" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"True Positives"</span>, <span class="st">"False Positives"</span>))</span></code></pre></div>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="sec-data_levels.html#cb192-1" tabindex="-1"></a><span class="fu">ggplot</span>(tpFpTable) <span class="sc">+</span></span>
<span id="cb192-2"><a href="sec-data_levels.html#cb192-2" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> inputLevel,</span>
<span id="cb192-3"><a href="sec-data_levels.html#cb192-3" tabindex="-1"></a>        <span class="at">y =</span> value,</span>
<span id="cb192-4"><a href="sec-data_levels.html#cb192-4" tabindex="-1"></a>        <span class="at">fill =</span> inputLevel) <span class="sc">+</span></span>
<span id="cb192-5"><a href="sec-data_levels.html#cb192-5" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb192-6"><a href="sec-data_levels.html#cb192-6" tabindex="-1"></a>    <span class="fu">facet_grid</span>(contrast <span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb192-7"><a href="sec-data_levels.html#cb192-7" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb192-8"><a href="sec-data_levels.html#cb192-8" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb192-9"><a href="sec-data_levels.html#cb192-9" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb192-10"><a href="sec-data_levels.html#cb192-10" tabindex="-1"></a>          <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb192-11"><a href="sec-data_levels.html#cb192-11" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div>
<p><img src="msqrob2_book_files/figure-html/unnamed-chunk-213-1.png" width="576"></p>

</div>
</div>
</div>
<p style="text-align: center;">
<a href="sec-advanced.html"><button class="btn btn-default">Previous</button></a>
<a href="sec-francisella.html"><button class="btn btn-default">Next</button></a>
</p>
<p class="build-date">Page built: 
2025-10-07
 using 
R version 4.5.1 (2025-06-13)
</p>
</div>
</div>



</body>
</html>
